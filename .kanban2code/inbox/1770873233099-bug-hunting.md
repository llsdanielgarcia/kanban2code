---
stage: inbox
created: 2026-02-12T05:13:53.100Z
agent: 07-üí¨conversational
mode: planner
---

# Bug-hunting

@docs/architecture.md @.kanban2code/projects/overhaul/overhaul-agents-modes-runner.md alright, major update has been implemented, nothing is working let's start debugging. Agent (LLM PROVIDER) has the name of the agents "planner" for example instead of LLM providers, mode (optional) Only has 3 modes, auditor, coder planner. Identify the bug first, not try to solve it, just indentify, find the root cause and list the files that needs to be edited to fix it.

---

## Bug Analysis

### Problem Statement

The Agent field (which should represent LLM provider) shows mode names like "planner", "coder", "auditor" instead of actual LLM providers like "opus", "codex", "kimi", "glm".

### Root Cause

**The migration from `agent` (behavior role) ‚Üí `agent` (LLM provider) + `mode` (behavior role) was never executed on this workspace.**

Evidence:

1. **`_agents/` folder still contains OLD behavior files**:
   - `07-üí¨conversational.md`, `04-üìãplanner.md`, `05-‚öôÔ∏ècoder.md`, `06-‚úÖauditor.md`, etc.
   - These are behavior instruction files, NOT CLI config files
   - Should have been REPLACED with: `opus.md`, `codex.md`, `kimi.md`, `glm.md`

2. **`_modes/` folder exists but is INCOMPLETE**:
   - Only has 3 files: `planner.md`, `auditor.md`, `coder.md`
   - Missing: `roadmapper.md`, `architect.md`, `splitter.md`, `conversational.md`
   - Migration step 1 was partially done

3. **`config.json` missing `modeDefaults`**:
   - Has old `agents` section with behavior descriptions
   - Missing `modeDefaults` section that maps mode ‚Üí default LLM provider

4. **Migration command was never run**:
   - `src/commands/index.ts` has `kanban2code.migrateAgentsModes` registered
   - But the workspace state shows migration never completed

5. **UI agent picker reads from `_agents/`**:
   - `listAvailableAgents()` in `context.ts` reads files in `_agents/`
   - Shows old behavior files as "agents" because those files still exist

### What Should Have Happened (per overhaul spec)

1. Copy behavior files from `_agents/` ‚Üí `_modes/` (strip emoji prefixes)
2. Update all task frontmatter: add `mode: {old-agent-name}`, set `agent` to LLM provider default
3. Replace `_agents/` files with CLI config schemas (`opus.md`, `codex.md`, etc.)
4. Add `modeDefaults` to `config.json`

### Files That Need to Be Fixed

**Immediate fix - Run the migration:**

- Run command: `kanban2code.migrateAgentsModes`
- OR manually execute migration logic in `src/services/migration.ts:migrateAgentsToModes()`

**If migration code has bugs, these files need edits:**

1. `src/services/migration.ts` - Migration logic
2. `.kanban2code/config.json` - Add `modeDefaults` section
3. `.kanban2code/_agents/*.md` - Replace with CLI config files (or let migration do it)
4. `.kanban2code/_modes/*.md` - Complete the mode files

**UI layer (if migration succeeds but UI still wrong):**

1. `src/services/context.ts:listAvailableAgents()` - Should read from `agent-service.ts` for CLI configs
2. `src/webview/ui/components/AgentPicker.tsx` - Check if using correct agent source
