// This file is auto-generated by build.ts. Do not edit directly.

export const BUNDLED_CONTEXTS: Record<string, string> = {
  "ai-guide.md": "---\nname: Kanban2Code AI Guide\ndescription: Operational guide for AI agents and providers in a Kanban2Code workspace.\nscope: global\ncreated: 2025-12-14\nupdated: 2026-02-12\n---\n\n# Kanban2Code AI Guide\n\nThis guide defines how to create, edit, and progress task files in Kanban2Code.\n\n## 1) Core Concepts\n\n- `stage`: where the task is in the lifecycle (`inbox`, `plan`, `code`, `audit`, `completed`)\n- `agent`: behavioral role/instructions (`planner`, `coder`, `auditor`, etc.)\n- `provider`: LLM provider runtime config (CLI + model + flags)\n\nRule of thumb:\n- Agent controls **how** the assistant behaves.\n- Provider controls **what runtime** executes the prompt.\n\n## 2) Workspace Layout\n\nKanban2Code stores data under `.kanban2code/`:\n\n- `inbox/` and `projects/**`: task files\n- `_agents/`: agent behavioral instructions\n- `_providers/`: provider CLI config files\n- `_context/`: shared context docs\n- `_archive/`: completed tasks\n- `config.json`: config and `providerDefaults`\n\n## 3) Task File Format\n\nTask files are markdown with optional YAML frontmatter.\n\n```md\n---\nstage: plan\nagent: planner\nprovider: sonnet\ntags: [feature, p1]\ncontexts: [ai-guide]\nattempts: 0\n---\n\n# Improve runner retry handling\n\n## Goal\nMake retry behavior clearer and safer.\n```\n\nFields commonly used:\n- `stage`: `inbox | plan | code | audit | completed`\n- `agent`: behavioral role (e.g. planner, coder, auditor)\n- `provider`: runtime/LLM config identifier (optional)\n- `attempts`: integer retry count for runner workflow\n- `tags`, `contexts`, `parent`, `order`, `created`\n\n## 4) Stage Progression\n\nDefault execution path:\n- `inbox -> plan -> code -> audit -> completed`\n\nAudit outcomes:\n- accepted audit -> `completed`\n- failed audit -> `code` with incremented `attempts`\n- failed audit with `attempts >= 2` -> runner hard stop for human review\n\n## 5) Context Assembly\n\nPrompt context is assembled in layers:\n\n1. global: `.kanban2code/how-it-works.md`, `.kanban2code/architecture.md`, `.kanban2code/project-details.md`\n2. agent/provider instructions: from `_agents/` first\n3. project context: `.kanban2code/projects/<project>/_context.md`\n4. phase context: `.kanban2code/projects/<project>/<phase>/_context.md`\n5. custom contexts: from `contexts:`\n\nWhen runner mode is active, prompt context includes:\n- `<runner automated=\"true\" />`\n\n## 6) Dual-Mode Behavior (Manual vs Automated)\n\nAgent instructions must support two execution environments.\n\n### Manual mode (default)\n- Assistant can edit task frontmatter directly for stage handoff.\n- Assistant can follow legacy manual workflow actions.\n\n### Automated mode (runner flag present)\n- Assistant must **not** edit frontmatter.\n- Assistant must **not** commit.\n- Assistant outputs structured markers only.\n- Runner applies all transitions and commit operations.\n\n## 7) Structured Output Markers\n\nUse HTML comment markers so runner parser can detect outcomes.\n\n- Stage transition:\n  - `<!-- STAGE_TRANSITION: code -->`\n  - `<!-- STAGE_TRANSITION: audit -->`\n  - `<!-- STAGE_TRANSITION: completed -->`\n- Changed files:\n  - `<!-- FILES_CHANGED: src/a.ts, src/b.ts -->`\n- Audit result:\n  - `<!-- AUDIT_RATING: 8 -->`\n  - `<!-- AUDIT_VERDICT: ACCEPTED -->`\n  - `<!-- AUDIT_VERDICT: NEEDS_WORK -->`\n\n## 8) Planner/Coder/Auditor Expectations\n\n- Planner:\n  - Produce implementation-ready plan and clear tests\n  - Transition to code (manual edit or stage marker depending on mode)\n\n- Coder:\n  - Implement requested changes and tests\n  - In automated mode output both stage transition and files changed markers\n\n- Auditor:\n  - Prioritize correctness, regressions, and missing tests\n  - Use `.kanban2code/architecture.md` (root-level) for architecture updates\n  - In automated mode output `AUDIT_RATING` + `AUDIT_VERDICT`\n  - Retry-awareness in automated mode: be slightly more lenient on attempt 2+, while keeping standards\n\n## 9) Practical Examples\n\nManual planner handoff (frontmatter edited directly):\n\n```md\n---\nstage: code\nagent: coder\nprovider: opus\ntags: [feature, p1]\n---\n\n# Add stage-aware provider picker\n\n## Goal\nImplement UI provider picker behavior for plan/code/audit tasks.\n```\n\nAutomated coder output snippet:\n\n```md\nImplemented provider picker and tests.\n\n<!-- STAGE_TRANSITION: audit -->\n<!-- FILES_CHANGED: src/webview/ui/components/ProviderPicker.tsx, tests/webview/components/ProviderPicker.test.tsx -->\n```\n\nAutomated auditor output snippet:\n\n```md\nNo blocking issues found.\n\n<!-- AUDIT_RATING: 9 -->\n<!-- AUDIT_VERDICT: ACCEPTED -->\n```\n\n## 10) Common Mistakes To Avoid\n\n- Editing frontmatter in automated mode\n- Omitting structured markers in automated mode\n- Writing architecture notes to `_context/architecture.md` instead of `.kanban2code/architecture.md`\n- Marking a task complete without confirming tests/build expectations\n",
  "architecture.md": "---\nname: Architecture\ndescription: Codebase and project description\nscope: global\ncreated: '2025-12-17'\nfile_references:\n  - docs/architecture.md\n---\n\n# Architecture Context\n\nThis context file links to the main architecture documentation. When the auditor accepts a task (rating 8+), they should update this file or the linked documentation to reflect any new files created.\n\nSee: [docs/architecture.md](docs/architecture.md) for the full architecture documentation including directory structure.\n\n## Accepted Task Updates\n\n- date: 2026-02-11\n  - task: `task1.1-add-agent-and-attempts-fields-to-task-interface`\n  - files-updated:\n    - `src/types/task.ts` (`Task` now includes optional `agent?: string` and `attempts?: number`)\n    - `src/services/frontmatter.ts` (parse + stringify support for `agent` and `attempts`)\n  - new-files-created: none\n\n- date: 2026-02-11\n  - task: `task1.2-define-providerconfig-and-agentconfig-types-with-zod-schemas`\n  - files-updated: none\n  - new-files-created:\n    - `src/types/provider.ts` - Defines `ProviderConfig` interface and Zod schema for CLI configuration\n    - `src/types/agent.ts` - Defines `AgentConfig` interface and Zod schema for agent configuration\n    - `tests/provider-agent-schemas.test.ts` - Tests for the provider and agent schema validation\n\n- date: 2026-02-11\n  - task: `task1.3-add-agents-folder-and-logs-folder-constants`\n  - files-updated:\n    - `src/core/constants.ts` (added `AGENTS_FOLDER = '_agents'` and `LOGS_FOLDER = '_logs'`)\n  - new-files-created: none\n\n- date: 2026-02-11\n  - task: `task2.1-create-agentservice-crud-for-agents`\n  - files-updated:\n    - `docs/architecture.md` (added `agent-service.ts` to service list)\n  - new-files-created:\n    - `src/services/agent-service.ts` - Service for CRUD operations on agent files\n    - `tests/agent-service.test.ts` - Tests for agent files CRUD operations\n\n- date: 2026-02-11\n  - task: `task2.2-create-providerservice-crud-for-new-providers-cli-config-files`\n  - files-updated: none\n  - new-files-created:\n    - `src/services/provider-service.ts` - CRUD service for provider CLI configuration files in `_providers/`\n    - `tests/provider-service.test.ts` - Tests for provider CLI config CRUD operations\n\n- date: 2026-02-11\n  - task: `task2.3-update-frontmatter-parser-for-agent-and-attempts`\n  - files-updated:\n    - `src/services/frontmatter.ts` (parse/serialize `agent` and `attempts` fields)\n    - `src/services/task-content.ts` (`saveTaskWithMetadata` metadata interface now includes `agent`)\n    - `src/webview/KanbanPanel.ts` (threads `agent` through `FullTaskDataLoaded` and `SaveTaskWithMetadata`)\n    - `src/webview/SidebarProvider.ts` (threads `agent` through `FullTaskDataLoaded` and `SaveTaskWithMetadata`)\n    - `src/webview/ui/components/TaskEditorModal.tsx` (manages `agent` state, dirty checking, save)\n    - `tests/frontmatter.test.ts` (4 new tests for agent/attempts parsing, serialization, round-trip)\n  - new-files-created: none\n\n- date: 2026-02-11\n  - task: `task2.4-update-prompt-builder-for-agent-aware-context-loading`\n  - files-updated:\n    - `src/services/prompt-builder.ts` (added `loadAgentInstructions` with 3-step fallback chain, `buildRunnerPrompt` export, runner `<runner automated=\"true\" />` injection)\n  - new-files-created: none\n  - tests-added:\n    - `tests/prompt-builder.test.ts` (5 new tests: agent loading, provider-to-agent fallback, provider fallback, runner prompt shape, runner automated flag)\n\n- date: 2026-02-11\n  - task: `task2.5-update-stage-manager-for-agent-aware-auto-assignment`\n  - files-updated:\n    - `src/services/stage-manager.ts` (added `AgentInfo`, `listAgentsWithStage`, `getDefaultAgentForStage`, `getDefaultProviderForAgent`, `shouldAutoUpdateAgent`; updated `updateTaskStage` to auto-set `agent` and `provider` from agent defaults with fallback to stage-based provider assignment)\n  - new-files-created: none\n  - tests-added:\n    - `tests/stage-manager.test.ts` (5 new tests: agent-for-stage lookup, provider-for-agent config lookup, auto-set agent+provider on code/audit stages, manual agent preservation)\n\n- date: 2026-02-11\n  - task: `task3.1-create-migration-service-providers-to-agents-new-providers`\n  - files-updated:\n    - `.kanban2code/.gitignore` (added `_logs/` entry)\n  - new-files-created:\n    - `src/services/migration.ts` - Atomic migration service for providers → agents transition\n    - `tests/migration.test.ts` - Tests for migration service functionality\n  - tests-added:\n    - 4 tests: migration success, idempotence, rollback, gitignore update\n\n- date: 2026-02-11\n  - task: `task3.2-update-build-script-to-bundle-agents`\n  - files-updated:\n    - `build.ts` (added `_agents/` directory reading to `generateBundledContent()`)\n  - new-files-created:\n    - `src/assets/agents.ts` - Auto-generated file containing bundled agent files\n\n- date: 2026-02-11\n  - task: `task3.3-update-scaffolder-for-agents-directory`\n  - files-updated:\n    - `src/services/scaffolder.ts` (added `_agents/` to scaffold and sync functions)\n    - `tests/scaffolder.test.ts` (added tests for agent scaffolding)\n  - new-files-created: none\n  - tests-added:\n    - 2 tests: scaffold creates agents, sync preserves existing agents\n\n- date: 2026-02-11\n  - task: `task3.4-register-migration-command-verify-file-watcher-coverage`\n  - files-updated:\n    - `src/commands/index.ts` (registered `kanban2code.migrateProvidersAgents` command with VS Code progress notification)\n    - `src/services/task-watcher.ts` (added `_agents/` and `_providers/` exclusion in `isTaskFile()`)\n    - `package.json` (added command declaration and activation event)\n  - new-files-created: none\n  - tests-added:\n    - 2 tests in `tests/task-watcher.test.ts`: `_agents/` and `_providers/` exclusion from task events\n\n- date: 2026-02-11\n  - task: `task4.0-deterministic-task-ordering-in-scanner`\n  - files-updated:\n    - `src/services/scanner.ts` (added `sortTasks` and `getOrderedTasksForStage` exports; `loadAllTasks` now returns sorted results)\n    - `tests/scanner.test.ts` (added 10 tests for deterministic ordering)\n  - new-files-created: none\n  - tests-added:\n    - 10 tests: order field sorting, undefined order handling, filename tiebreaker, stage filtering, immutability\n\n- date: 2026-02-11\n  - task: `task4.1-cli-adapter-interface-claude-adapter`\n  - files-updated: none\n  - new-files-created:\n    - `src/runner/cli-adapter.ts` - `CliAdapter` interface, `CliResponse`, `CliCommandResult`, `CliAdapterOptions` types\n    - `src/runner/adapters/claude-adapter.ts` - Claude CLI adapter implementation\n    - `tests/claude-adapter.test.ts` - Tests for Claude adapter\n\n- date: 2026-02-11\n  - task: `task4.2-codex-kimi-and-kilo-cli-adapters-adapter-factory`\n  - files-updated: none\n  - new-files-created:\n    - `src/runner/adapters/codex-adapter.ts` - Codex CLI adapter (stdin prompt, JSONL output)\n    - `src/runner/adapters/kimi-adapter.ts` - KIMI CLI adapter (-p flag, plain text output)\n    - `src/runner/adapters/kilo-adapter.ts` - Kilo CLI adapter (positional prompt, JSONL output)\n    - `src/runner/adapter-factory.ts` - Factory function `getAdapterForCli(cli) → CliAdapter`\n    - `tests/other-cli-adapters.test.ts` - Tests for Codex, KIMI, Kilo adapters and factory\n\n- date: 2026-02-11\n  - task: `task4.3-structured-output-parser`\n  - files-updated: none\n  - new-files-created:\n    - `src/runner/output-parser.ts` - Structured marker extraction for LLM output\n    - `tests/output-parser.test.ts` - Tests for output-parser\n  - tests-added:\n    - 8 tests: stage transitions, audit ratings, verdicts, file lists, and fallbacks\n\n- date: 2026-02-11\n  - task: `task4.5-git-operations-for-runner`\n  - files-updated: none\n  - new-files-created:\n    - `src/runner/git-ops.ts` - Git helper functions for runner (`isWorkingTreeClean`, `hasUncommittedChanges`, `commitRunnerChanges`)\n    - `tests/git-ops.test.ts` - Tests for git operations (3 tests)\n\n- date: 2026-02-11\n  - task: `task4.4-runner-execution-engine`\n  - files-updated: none\n  - new-files-created:\n    - `src/runner/runner-engine.ts` - Core runner execution engine with sequential pipeline logic\n    - `tests/runner-engine.test.ts` - Tests for RunnerEngine\n  - tests-added:\n    - 6 tests: pipeline execution, audit failure loops, CLI crash handling, dirty git check\n\n- date: 2026-02-11\n  - task: `task4.6-runner-log-report-generator`\n  - files-updated: none\n  - new-files-created:\n    - `src/runner/runner-log.ts` - `RunnerLog` class for generating markdown run reports\n    - `tests/runner-log.test.ts` - Tests for runner log generation and persistence\n  - tests-added:\n    - 4 tests: markdown headers, summary counts, per-task fields, zero-task handling\n\n- date: 2026-02-11\n  - task: `task4.7-register-runner-vs-code-commands`\n  - files-updated:\n    - `src/commands/index.ts` (registered runner commands)\n    - `src/extension.ts` (runner singleton lifecycle, progress API)\n    - `package.json` (added runner commands)\n  - new-files-created:\n    - `tests/runner-singleton.test.ts` - Tests for runner singleton and cancellation\n\n- date: 2026-02-11\n  - task: `task5.1-update-messaging-protocol-for-modes-and-runner`\n  - files-updated:\n    - `src/webview/messaging.ts` (added mode-management and runner-control message types; added `RunnerState` type/schema/parser)\n    - `tests/webview.test.ts` (added EnvelopeSchema coverage for new message types and RunnerState validation tests)\n  - new-files-created: none\n\n- date: 2026-02-11\n  - task: `task5.2-modepicker-component-update-agentpicker`\n  - files-updated:\n    - `src/webview/ui/components/AgentPicker.tsx` (Agent picker now targets LLM providers, updates label to \"Agent (LLM Provider)\", and keeps provider description hint behavior)\n    - `src/webview/ui/components/TaskEditorModal.tsx` (uses provider-based AgentPicker wiring)\n    - `src/webview/ui/components/TaskModal.tsx` (uses provider-based AgentPicker wiring)\n    - `tests/webview/components/AgentPicker.test.tsx` (covers provider rendering, label text, no-selection behavior, and canonical name resolution)\n  - new-files-created:\n    - `src/webview/ui/components/ModePicker.tsx` - Mode dropdown component with mode description hint and \"Create new mode\" action\n    - `tests/webview/components/ModePicker.test.tsx` - ModePicker component tests for rendering, selection, callbacks, and no-selection behavior\n\n- date: 2026-02-11\n  - task: `task5.3-runner-controls-on-column-headers`\n  - files-updated:\n    - `src/webview/ui/components/Column.tsx` (added runner control buttons: play, play-all, stop; visibility logic based on `isRunnerActive` and `stage`)\n    - `src/webview/ui/components/BoardHorizontal.tsx` (passed down runner control props to Column)\n    - `src/webview/ui/styles/main.css` (styles for runner controls and buttons)\n    - `tests/webview/column.test.tsx` (added 6 tests for runner control visibility, behavior, and callbacks)\n  - new-files-created: none\n\n- date: 2026-02-12\n  - task: `task5.4-update-taskcard-for-mode-runner-status`\n  - files-updated:\n    - `src/webview/ui/components/TaskCard.tsx` (footer now renders `mode | agent` when both exist, shows agent-only fallback, adds per-card run action and running-state indicator)\n    - `src/webview/ui/components/Icons.tsx` (added `PlayIcon` for card-level run action)\n    - `src/webview/ui/components/Column.tsx` (threads `runningTaskId` and `onRunTask` into TaskCard)\n    - `src/webview/ui/components/BoardHorizontal.tsx` (threads `runningTaskId` and `onRunTask` into Column)\n    - `src/webview/ui/styles/main.css` (added running card pulse border, spinner, and disabled action styling)\n    - `tests/webview/taskcard.test.tsx` (added tests for mode+agent footer display, run button stage visibility, and active runner indicator)\n  - new-files-created: none\n\n- date: 2026-02-12\n  - task: `task5.5-update-taskmodal-and-taskeditormodal-for-mode-field`\n  - files-updated:\n    - `src/webview/ui/components/TaskModal.tsx` (added ModePicker below AgentPicker, `mode` in form data and CreateTask payload)\n    - `src/webview/ui/components/TaskEditorModal.tsx` (added ModePicker to Assignment section, `mode` in metadata state, dirty checking, and SaveTaskWithMetadata payload)\n    - `src/webview/ui/components/Sidebar.tsx` (threads `modes` from `useTaskData` to `TaskModal`)\n    - `src/webview/ui/components/Board.tsx` (threads `modes` from `useTaskData` to `TaskModal`)\n    - `src/webview/ui/hooks/useTaskData.ts` (exposes `modes` in return value, handles `InitState` modes payload)\n    - `src/webview/SidebarProvider.ts` (loads modes via `listAvailableModes`, sends in `InitState` and `FullTaskDataLoaded`)\n    - `src/webview/KanbanPanel.ts` (loads modes via `listAvailableModes`, sends in `InitState` and `FullTaskDataLoaded`)\n    - `src/commands/index.ts` (writes `mode` to frontmatter in `newTask` command)\n    - `tests/webview/task-modal-create-project.test.tsx` (added tests for mode+agent picker rendering and CreateTask payload)\n    - `tests/webview/task-editor-modal.test.tsx` (added tests for mode+agent picker rendering, SaveTaskWithMetadata payload with mode, null mode backward compat)\n  - new-files-created: none\n\n- date: 2026-02-12\n  - task: `task5.6-wire-runner-messages-through-webview-hosts`\n  - files-updated:\n    - `src/webview/KanbanPanel.ts` (added `RunTask`, `RunColumn`, `StopRunner` message handlers; subscribes to `onRunnerStateChanged` and posts `RunnerStateChanged` to webview; includes runner state in `InitState`)\n    - `src/webview/SidebarProvider.ts` (added `RequestModes`, `CreateMode`, `RunTask`, `RunColumn`, `StopRunner` message handlers; subscribes to `onRunnerStateChanged` and posts `RunnerStateChanged` to webview; includes runner state in `InitState`)\n    - `src/webview/ui/hooks/useTaskData.ts` (exposes `modes`, `isRunnerActive`, `activeRunnerTaskId` in return value; handles `RunnerStateChanged` and `ModesLoaded` messages)\n  - new-files-created:\n    - `src/runner/runner-state.ts` - Simple event emitter module for runner state (get/set/subscribe)\n    - `tests/webview-host-runner.test.ts` - Tests for webview host runner message handling\n    - `tests/webview/useTaskData.runner.test.tsx` - Tests for useTaskData runner state tracking\n\n- date: 2026-02-12\n  - task: `task5.7-modemodal-component-create-edit-mode`\n  - files-updated:\n    - `src/webview/ui/components/index.ts` (added `ModeModal` barrel export)\n    - `src/webview/ui/styles/main.css` (added `.mode-modal` size class alongside `.agent-modal`)\n  - new-files-created:\n    - `src/webview/ui/components/ModeModal.tsx` - Modal for creating and editing mode files (glassmorphic pattern)\n    - `tests/webview/components/ModeModal.test.tsx` - Tests for ModeModal (field rendering, validation, edit mode pre-population)\n\n- date: 2026-02-12\n  - task: `task5.8-update-context-menu-for-mode-and-runner-actions`\n  - files-updated:\n    - `src/webview/ui/components/TaskContextMenu.tsx` (added \"Run Task\" action with runner-active/stage guard, \"Change Mode\" submenu, \"Change Agent\" submenu, and `updateTaskMetadata` helper for `SaveTaskWithMetadata`)\n    - `src/webview/ui/components/Sidebar.tsx` (passes `modes`, `agents`, `isRunnerActive` to TaskContextMenu)\n    - `src/webview/ui/components/Board.tsx` (passes `modes`, `agents`, `isRunnerActive` to TaskContextMenu)\n    - `tests/webview/components/TaskContextMenu.test.tsx` (4 tests: Run Task visibility, disabled state, mode submenu, agent submenu)\n  - new-files-created: none\n\n- date: 2026-02-12\n  - task: `task6.2-redesign-coder-mode-for-structured-output`\n  - files-updated:\n    - `.kanban2code/_modes/coder.md` (added dual-mode instructions: Mode Detection, Manual/Automated output and workflow sections; explicit no-commit rule in automated mode)\n  - new-files-created: none\n\n- date: 2026-02-12\n  - task: `refactor-mode-to-agent-and-agent-to-provider`\n  - description: Comprehensive refactoring to align terminology with industry standards.\n  - files-updated:\n    - `src/types/*.ts`, `src/services/*.ts`, `src/runner/*.ts`, `src/webview/*.tsx`, `tests/*.ts`\n    - `package.json`, `build.ts`, `scaffolder.ts`\n  - new-files-created:\n    - `.kanban2code/_providers/` (moved from defunct modes)\n    - `src/assets/providers.ts` (replaced `modes.ts`)\n  - status: completed\n",
  "skills-index.json": "{\n  \"version\": \"1.0.0\",\n  \"last_updated\": \"2025-12-26\",\n  \"framework_detection\": {\n    \"nextjs\": {\n      \"files\": [\"next.config.js\", \"next.config.ts\", \"next.config.mjs\"],\n      \"package_json_deps\": [\"next\"],\n      \"keywords\": [\"next.js\", \"nextjs\", \"app router\", \"pages router\"]\n    },\n    \"react\": {\n      \"files\": [\"*.tsx\", \"*.jsx\"],\n      \"package_json_deps\": [\"react\", \"react-dom\"],\n      \"keywords\": [\"react\", \"component\", \"hooks\", \"useState\", \"useEffect\"]\n    },\n    \"python\": {\n      \"files\": [\"*.py\", \"pyproject.toml\", \"setup.py\", \"requirements.txt\"],\n      \"keywords\": [\"python\", \"pandas\", \"numpy\", \"greykite\", \"sklearn\", \"fastapi\", \"flask\", \"django\"]\n    }\n  },\n  \"core_skills\": [\n    {\n      \"name\": \"Next.js 16 Core\",\n      \"file\": \"_context/skills/nextjs-core-skills.md\",\n      \"framework\": \"nextjs\",\n      \"always_attach\": true,\n      \"priority\": 10,\n      \"description\": \"Mandatory baseline for Next.js 16. Covers async APIs (params, cookies, headers), proxy.ts migration, React 19 patterns (useActionState), and parallel route requirements.\"\n    },\n    {\n      \"name\": \"React + TypeScript Core\",\n      \"file\": \"_context/skills/react-core-skills.md\",\n      \"framework\": \"react\",\n      \"always_attach\": true,\n      \"priority\": 9,\n      \"description\": \"React/TypeScript naming conventions and patterns. Enforces PascalCase components, camelCase variables, {Component}Props interfaces, and hook best practices.\"\n    },\n    {\n      \"name\": \"Python Core (PEP 8)\",\n      \"file\": \"_context/skills/python-core-skills.md\",\n      \"framework\": \"python\",\n      \"always_attach\": true,\n      \"priority\": 9,\n      \"description\": \"Python naming conventions and best practices. Enforces PEP 8 snake_case, type hints, docstrings, and Pythonic patterns.\"\n    }\n  ],\n  \"conditional_skills\": [\n    {\n      \"name\": \"Caching & Data Fetching\",\n      \"file\": \"_context/skills/skill-caching-data-fetching.md\",\n      \"framework\": \"nextjs\",\n      \"triggers\": {\n        \"keywords\": [\n          \"cache\",\n          \"caching\",\n          \"fetch\",\n          \"revalidate\",\n          \"revalidateTag\",\n          \"cacheTag\",\n          \"cacheLife\",\n          \"use cache\",\n          \"unstable_cache\",\n          \"ISR\",\n          \"stale\",\n          \"PPR\",\n          \"partial prerendering\"\n        ],\n        \"files\": [\n          \"**/use-cache.ts\",\n          \"**/cache.ts\",\n          \"**/data.ts\",\n          \"**/lib/fetch*.ts\"\n        ],\n        \"task_patterns\": [\n          \"performance\",\n          \"slow page\",\n          \"data not updating\",\n          \"stale data\",\n          \"caching strategy\",\n          \"incremental static regeneration\"\n        ]\n      },\n      \"description\": \"Deep dive into 'use cache' directive, cacheLife profiles (seconds/minutes/hours/days/weeks/max), cacheTag for invalidation, PPR patterns, and the 'uncached by default' paradigm shift.\"\n    },\n    {\n      \"name\": \"Server Actions & Mutations\",\n      \"file\": \"_context/skills/skill-server-actions-mutations.md\",\n      \"framework\": \"nextjs\",\n      \"triggers\": {\n        \"keywords\": [\n          \"server action\",\n          \"use server\",\n          \"useActionState\",\n          \"useFormState\",\n          \"useFormStatus\",\n          \"form action\",\n          \"FormData\",\n          \"mutation\",\n          \"submit\",\n          \"zod\",\n          \"validation\",\n          \".bind\"\n        ],\n        \"files\": [\n          \"**/actions.ts\",\n          \"**/actions/*.ts\",\n          \"**/*-action.ts\"\n        ],\n        \"task_patterns\": [\n          \"form submission\",\n          \"create form\",\n          \"update data\",\n          \"delete record\",\n          \"handle form\",\n          \"validate input\"\n        ]\n      },\n      \"description\": \"Security patterns (Zod validation mandatory), useActionState migration from useFormState, .bind() for secure argument passing, redirect() placement outside try/catch.\"\n    },\n    {\n      \"name\": \"Routing & Layouts\",\n      \"file\": \"_context/skills/skill-routing-layouts.md\",\n      \"framework\": \"nextjs\",\n      \"triggers\": {\n        \"keywords\": [\n          \"parallel route\",\n          \"@modal\",\n          \"@slot\",\n          \"default.js\",\n          \"default.tsx\",\n          \"intercepting route\",\n          \"(.)folder\",\n          \"(..)folder\",\n          \"layout.tsx\",\n          \"loading.js\",\n          \"error.js\",\n          \"route group\"\n        ],\n        \"files\": [\n          \"**/default.tsx\",\n          \"**/default.js\",\n          \"**/@*/page.tsx\",\n          \"**/loading.tsx\",\n          \"**/error.tsx\"\n        ],\n        \"task_patterns\": [\n          \"modal\",\n          \"sidebar\",\n          \"navigation\",\n          \"nested layout\",\n          \"create page\",\n          \"add route\",\n          \"parallel slot\"\n        ]\n      },\n      \"description\": \"Parallel routes (default.js requirement), intercepting routes syntax (.)/(..)/(...), async params in layouts, loading.js and error.js patterns.\"\n    },\n    {\n      \"name\": \"next-intl (App Router i18n)\",\n      \"file\": \"_context/skills/skill-next-intl.md\",\n      \"framework\": \"nextjs\",\n      \"triggers\": {\n        \"keywords\": [\n          \"next-intl\",\n          \"i18n\",\n          \"internationalization\",\n          \"localization\",\n          \"locale\",\n          \"locales\",\n          \"translations\",\n          \"NextIntlClientProvider\",\n          \"setRequestLocale\",\n          \"defineRouting\",\n          \"createNavigation\",\n          \"getRequestConfig\",\n          \"localePrefix\"\n        ],\n        \"files\": [\n          \"**/i18n/routing.ts\",\n          \"**/i18n/navigation.ts\",\n          \"**/i18n/request.ts\",\n          \"**/middleware.ts\",\n          \"messages/*.json\"\n        ],\n        \"task_patterns\": [\n          \"i18n setup\",\n          \"localize routes\",\n          \"localized navigation\",\n          \"translate UI\",\n          \"multi-language\",\n          \"locale detection\"\n        ]\n      },\n      \"description\": \"Next.js 16 App Router i18n with next-intl: async params, setRequestLocale, NextIntlClientProvider, defineRouting, middleware matcher, and navigation wrappers.\"\n    },\n    {\n      \"name\": \"Drizzle ORM (PostgreSQL)\",\n      \"file\": \"_context/skills/skill-drizzle-orm.md\",\n      \"framework\": \"node\",\n      \"triggers\": {\n        \"keywords\": [\n          \"drizzle\",\n          \"drizzle-orm\",\n          \"drizzle-kit\",\n          \"pgTable\",\n          \"jsonb\",\n          \"$type\",\n          \"db:push\",\n          \"db:generate\",\n          \"db:migrate\",\n          \"postgres\",\n          \"postgresql\",\n          \"migration\"\n        ],\n        \"files\": [\n          \"**/drizzle.config.ts\",\n          \"**/src/db/schema.ts\",\n          \"**/src/db/client.ts\",\n          \"drizzle/**/*.sql\"\n        ],\n        \"task_patterns\": [\n          \"drizzle orm\",\n          \"database schema\",\n          \"postgres migrations\",\n          \"jsonb handling\",\n          \"connection pooling\"\n        ]\n      },\n      \"description\": \"Drizzle ORM patterns for PostgreSQL: schema in TS, jsonb $type typing, pg Pool usage, indexes in pgTable callback, and dev/prod migration workflow.\"\n    },\n    {\n      \"name\": \"HTTP Security Headers (Next.js)\",\n      \"file\": \"_context/skills/skill-http-security-headers.md\",\n      \"framework\": \"nextjs\",\n      \"triggers\": {\n        \"keywords\": [\n          \"Content-Security-Policy\",\n          \"CSP\",\n          \"security headers\",\n          \"headers()\",\n          \"next.config\",\n          \"X-Frame-Options\",\n          \"X-Content-Type-Options\",\n          \"Referrer-Policy\",\n          \"Permissions-Policy\",\n          \"clickjacking\",\n          \"XSS\",\n          \"nonce\",\n          \"strict-dynamic\"\n        ],\n        \"files\": [\n          \"**/next.config.ts\",\n          \"**/next.config.js\",\n          \"**/next.config.mjs\",\n          \"**/proxy.ts\",\n          \"**/middleware.ts\"\n        ],\n        \"task_patterns\": [\n          \"security hardening\",\n          \"post-incident\",\n          \"add CSP\",\n          \"configure headers\",\n          \"prevent clickjacking\",\n          \"tighten referrer policy\"\n        ]\n      },\n      \"description\": \"Next.js HTTP response header hardening: baseline headers, CSP (static vs nonce), Report-Only rollout, and next.config headers() patterns.\"\n    },\n    {\n      \"name\": \"Tailwind CSS v4 (CSS-first)\",\n      \"file\": \"_context/skills/skill-tailwindcss-v4.md\",\n      \"framework\": \"react\",\n      \"triggers\": {\n        \"keywords\": [\n          \"tailwind v4\",\n          \"tailwindcss v4\",\n          \"tailwindcss\",\n          \"@theme\",\n          \"@source\",\n          \"@config\",\n          \"@tailwindcss/postcss\",\n          \"postcss.config\",\n          \"globals.css\",\n          \"tw-animate-css\",\n          \"tailwind.config.js\",\n          \"@tailwind base\",\n          \"@tailwind utilities\"\n        ],\n        \"files\": [\n          \"**/postcss.config.*\",\n          \"**/app/globals.css\",\n          \"**/src/app/globals.css\",\n          \"**/*.css\"\n        ],\n        \"task_patterns\": [\n          \"tailwind setup\",\n          \"tailwind migration\",\n          \"css-first\",\n          \"design tokens\",\n          \"theme variables\",\n          \"animate utilities\"\n        ]\n      },\n      \"description\": \"Tailwind CSS v4 CSS-first setup: @import \\\"tailwindcss\\\", @theme tokens, @tailwindcss/postcss, @source scan paths, legacy @config, and tw-animate-css integration.\"\n    },\n    {\n      \"name\": \"Testing Stack (Vitest + Playwright)\",\n      \"file\": \"_context/skills/skill-vitest-playwright-testing.md\",\n      \"framework\": \"nextjs\",\n      \"triggers\": {\n        \"keywords\": [\n          \"vitest\",\n          \"playwright\",\n          \"jsdom\",\n          \"@vitejs/plugin-react\",\n          \"vitest.config\",\n          \"playwright.config\",\n          \"*.test.ts\",\n          \"*.test.tsx\",\n          \"tests/*.spec.ts\",\n          \"coverage\",\n          \"next/headers\",\n          \"cookies()\",\n          \"headers()\",\n          \"supabase\",\n          \"vi.mock\"\n        ],\n        \"files\": [\n          \"**/vitest.config.ts\",\n          \"**/vitest.setup.ts\",\n          \"**/playwright.config.ts\",\n          \"tests/**/*.spec.ts\"\n        ],\n        \"task_patterns\": [\n          \"testing stack\",\n          \"add tests\",\n          \"unit tests\",\n          \"e2e tests\",\n          \"coverage\",\n          \"mock next headers\",\n          \"mock supabase\"\n        ]\n      },\n      \"description\": \"Conventions for Vitest (unit/component) + Playwright (E2E): file patterns, config baselines, coverage requirements, and mocking Next.js request scope and Supabase.\"\n    },\n    {\n      \"name\": \"Supabase Auth SSR (@supabase/ssr)\",\n      \"file\": \"_context/skills/skill-supabase-ssr.md\",\n      \"framework\": \"nextjs\",\n      \"triggers\": {\n        \"keywords\": [\n          \"@supabase/ssr\",\n          \"supabase ssr\",\n          \"supabase auth\",\n          \"createServerClient\",\n          \"createBrowserClient\",\n          \"proxy.ts\",\n          \"cookies.setAll\",\n          \"next/headers\",\n          \"getUser\",\n          \"getClaims\",\n          \"getSession\",\n          \"RLS\",\n          \"auth.uid\",\n          \"@supabase/auth-helpers-nextjs\"\n        ],\n        \"files\": [\n          \"proxy.ts\",\n          \"**/lib/supabase/client.ts\",\n          \"**/lib/supabase/server.ts\",\n          \"**/lib/supabase/proxy.ts\"\n        ],\n        \"task_patterns\": [\n          \"supabase auth\",\n          \"ssr auth\",\n          \"session leakage\",\n          \"cookie handling\",\n          \"rls policies\",\n          \"nextjs supabase\"\n        ]\n      },\n      \"description\": \"Security-first Supabase Auth for Next.js App Router using @supabase/ssr: browser vs server clients, cookie plumbing, proxy.ts session refresh, and RLS coordination.\"\n    },\n    {\n      \"name\": \"PostHog Analytics (Next.js)\",\n      \"file\": \"_context/skills/skill-posthog-analytics.md\",\n      \"framework\": \"nextjs\",\n      \"triggers\": {\n        \"keywords\": [\n          \"posthog\",\n          \"posthog-js\",\n          \"posthog-node\",\n          \"@posthog/react\",\n          \"analytics\",\n          \"$pageview\",\n          \"$pageleave\",\n          \"autocapture\",\n          \"server-only\",\n          \"client-only\",\n          \"runtime\",\n          \"nodejs\"\n        ],\n        \"files\": [\n          \"**/app/providers.tsx\",\n          \"**/lib/posthog-server.ts\",\n          \"**/lib/analytics/client.ts\",\n          \"**/lib/analytics/server.ts\"\n        ],\n        \"task_patterns\": [\n          \"add analytics\",\n          \"posthog integration\",\n          \"pageview tracking\",\n          \"custom events\",\n          \"server tracking\",\n          \"client tracking\"\n        ]\n      },\n      \"description\": \"PostHog integration patterns for Next.js App Router: strict client/server separation, provider setup, Node server tracking with flush/shutdown, pageview strategy, and standard event properties.\"\n    },\n    {\n      \"name\": \"Metadata & SEO\",\n      \"file\": \"_context/skills/skill-metadata-seo.md\",\n      \"framework\": \"nextjs\",\n      \"triggers\": {\n        \"keywords\": [\n          \"metadata\",\n          \"generateMetadata\",\n          \"SEO\",\n          \"openGraph\",\n          \"og:image\",\n          \"opengraph-image\",\n          \"sitemap\",\n          \"robots\",\n          \"meta tags\",\n          \"title\",\n          \"description\",\n          \"ImageResponse\"\n        ],\n        \"files\": [\n          \"**/opengraph-image.tsx\",\n          \"**/twitter-image.tsx\",\n          \"**/sitemap.ts\",\n          \"**/robots.ts\",\n          \"**/icon.tsx\"\n        ],\n        \"task_patterns\": [\n          \"SEO optimization\",\n          \"social sharing\",\n          \"meta tags\",\n          \"sitemap generation\",\n          \"open graph image\",\n          \"twitter card\"\n        ]\n      },\n      \"description\": \"Async generateMetadata signature change, ImageResponse with async params, sitemap.ts and robots.ts dynamic generation, image remotePatterns security.\"\n    },\n    {\n      \"name\": \"TypeScript & Config\",\n      \"file\": \"_context/skills/skill-typescript-config.md\",\n      \"framework\": \"nextjs\",\n      \"triggers\": {\n        \"keywords\": [\n          \"next.config\",\n          \"typescript\",\n          \"type error\",\n          \"Promise type\",\n          \"tsconfig\",\n          \"server-only\",\n          \"experimental\",\n          \"cacheComponents\",\n          \"@types/react\"\n        ],\n        \"files\": [\n          \"**/next.config.ts\",\n          \"**/next.config.js\",\n          \"**/tsconfig.json\"\n        ],\n        \"task_patterns\": [\n          \"type error\",\n          \"build error\",\n          \"configuration\",\n          \"setup project\",\n          \"module resolution\",\n          \"cannot be used as JSX\"\n        ]\n      },\n      \"description\": \"next.config.ts (typed config), Promise prop type patterns, React 19 type compatibility, server-only module protection, module resolution settings.\"\n    }\n  ]\n}\n",
  "skills/nextjs-core-skills.md": "---\nskill_name: nextjs-core-skills\nversion: \"16.0.10\"\nframework: Next.js\nreact_version: \"19\"\nlast_verified: \"2025-12-18\"\nalways_attach: true\npriority: 10\ntriggers:\n  - nextjs\n  - next.js\n  - app router\n  - react 19\n  - params\n  - cookies\n  - headers\n  - middleware\n  - proxy.ts\n---\n\n<!--\nLLM INSTRUCTION: This is a CORE skill file for Next.js 16.0.10.\nALWAYS apply these rules when generating Next.js code.\nYour training data likely contains v14/v15 patterns - OVERRIDE them with v16 patterns below.\nKey breaking changes: async params, proxy.ts, useActionState, uncached-by-default.\nWhen you see ❌ WRONG, that's what you might hallucinate. Use ✅ CORRECT instead.\n-->\n\n# Next.js 16 Core Skills\n\n> **Target:** Next.js 16.0.10 | **React:** 19 | **Last Verified:** 2025-12-18\n\n## 1. What AI Models Get Wrong\n\n- **Synchronous params access** → LLMs generate `Page({ params }: { params: { slug: string } })` because training data from v14 used sync access. In v16, params is a Promise.\n- **Using `middleware.ts`** → LLMs create middleware.ts because it existed in v14/15. In v16, it's deprecated in favor of `proxy.ts`.\n- **Assuming fetch is cached** → LLMs expect fetch to cache by default (v14 behavior). In v16, all fetches are uncached by default.\n- **Using `useFormState`** → LLMs import from 'react-dom' using React 18 patterns. React 19 renames this to `useActionState`.\n- **Omitting `default.js` in parallel routes** → LLMs forget this file, causing build failures in v16 which strictly requires it for all @slots.\n\n## 2. Golden Rules\n\n### ✅ DO\n- **Await all dynamic APIs** → `params`, `searchParams`, `cookies()`, `headers()` are Promises in v16\n- **Use `proxy.ts` for request interception** → Replaces middleware.ts, runs on Node.js by default\n- **Keep components Server by default** → Only add `'use client'` for interactivity (state, events, browser APIs)\n- **Create `default.js` for every parallel route slot** → Required fallback for soft navigation\n- **Use `useActionState` from 'react'** → React 19's replacement for useFormState\n\n### ❌ DON'T  \n- **Don't access params synchronously** → Causes runtime crash: \"params is a Promise\"\n- **Don't use `middleware.ts`** → Deprecated, use proxy.ts instead\n- **Don't use `useFormState` from 'react-dom'** → Renamed to useActionState in React 19\n- **Don't assume fetch caches** → v16 is uncached by default, opt-in with `'use cache'`\n- **Don't use `getServerSideProps`/`getStaticProps`** → Don't exist in App Router\n\n## 3. Critical Patterns\n\n### Async Params in Page Components\n\n**❌ WRONG (v14/v15 - Hallucination Risk):**\n```typescript\n// Sync access causes runtime crash in v16\nexport default function Page({ params }: { params: { slug: string } }) {\n  return <h1>{params.slug}</h1>; // Error: params is a Promise\n}\n```\n\n**✅ CORRECT (v16):**\n```typescript\n// Await the Promise props\ninterface Props {\n  params: Promise<{ slug: string }>;\n  searchParams: Promise<{ [key: string]: string | string[] | undefined }>;\n}\n\nexport default async function Page(props: Props) {\n  const params = await props.params;\n  const searchParams = await props.searchParams;\n  return <h1>{params.slug}</h1>;\n}\n```\n**Why:** v16's Partial Prerendering requires async access to support streaming dynamic content.\n\n---\n\n### Async Cookies and Headers\n\n**❌ WRONG (v14/v15 - Hallucination Risk):**\n```typescript\n// Sync access returns Promise object, not data\nimport { cookies, headers } from 'next/headers';\n\nexport default function Page() {\n  const cookieStore = cookies(); // Wrong: returns Promise\n  const token = cookieStore.get('token'); // undefined\n}\n```\n\n**✅ CORRECT (v16):**\n```typescript\nimport { cookies, headers } from 'next/headers';\n\nexport default async function Page() {\n  const cookieStore = await cookies();\n  const token = cookieStore.get('auth-token');\n  \n  const headerList = await headers();\n  const userAgent = headerList.get('user-agent');\n}\n```\n**Why:** Request APIs are async to support Edge runtime and streaming.\n\n---\n\n### Proxy.ts Instead of Middleware\n\n**❌ WRONG (v14/v15 - Hallucination Risk):**\n```typescript\n// middleware.ts - DEPRECATED\nimport { NextResponse } from 'next/server';\nimport type { NextRequest } from 'next/server';\n\nexport function middleware(request: NextRequest) {\n  return NextResponse.next();\n}\n```\n\n**✅ CORRECT (v16):**\n```typescript\n// proxy.ts - at project root or src/\nimport { NextResponse } from 'next/server';\nimport type { NextRequest } from 'next/server';\n\nexport async function proxy(request: NextRequest) {\n  const url = request.nextUrl;\n  \n  if (url.pathname === '/old') {\n    url.pathname = '/new';\n    return NextResponse.redirect(url);\n  }\n  \n  return NextResponse.next();\n}\n\nexport const config = {\n  matcher: ['/((?!api|_next/static|_next/image|favicon.ico).*)'],\n};\n```\n**Why:** Renamed for clarity—it's a proxy/interception layer, not middleware chain. Runs on Node.js by default.\n\n---\n\n### React 19 Form Pattern\n\n**❌ WRONG (v14/React 18 - Hallucination Risk):**\n```typescript\n'use client';\nimport { useFormState } from 'react-dom'; // Wrong import\n\nexport function Form() {\n  const [state, action] = useFormState(submitAction, null);\n}\n```\n\n**✅ CORRECT (v16/React 19):**\n```typescript\n'use client';\nimport { useActionState } from 'react'; // Correct import\n\nexport function Form() {\n  const [state, formAction, isPending] = useActionState(submitAction, null);\n  \n  return (\n    <form action={formAction}>\n      <input name=\"email\" />\n      <button disabled={isPending}>Submit</button>\n      {state?.error && <p>{state.error}</p>}\n    </form>\n  );\n}\n```\n**Why:** React 19 renamed useFormState to useActionState and added isPending.\n\n---\n\n### Parallel Routes Default.js\n\n**❌ WRONG (v14/v15 - Hallucination Risk):**\n```\napp/\n├── @modal/\n│   └── login/\n│       └── page.tsx\n└── layout.tsx\n// Missing default.tsx causes 404 on soft navigation!\n```\n\n**✅ CORRECT (v16):**\n```\napp/\n├── @modal/\n│   ├── default.tsx  ← REQUIRED\n│   └── login/\n│       └── page.tsx\n└── layout.tsx\n```\n\n```typescript\n// app/@modal/default.tsx\nexport default function Default() {\n  return null; // Render nothing when no modal active\n}\n```\n**Why:** v16 strictly requires default.js as fallback when slot has no matching route during soft navigation.\n\n## 4. Quick Reference Table\n\n| Feature | ❌ Don't | ✅ Do |\n|---------|---------|------|\n| Params | `{ params: { id: string } }` | `{ params: Promise<{ id: string }> }` |\n| Cookies | `const c = cookies()` | `const c = await cookies()` |\n| Headers | `const h = headers()` | `const h = await headers()` |\n| Middleware | `middleware.ts` | `proxy.ts` |\n| Form State | `useFormState` from 'react-dom' | `useActionState` from 'react' |\n| Caching | Assume cached by default | Use `'use cache'` explicitly |\n| Parallel Routes | Skip default.js | Create default.js for every @slot |\n| Config | `next.config.js` | `next.config.ts` (typed) |\n\n## 5. Checklist Before Coding\n\n- [ ] Verify Next.js version is 16.x and React 19 in package.json\n- [ ] All `params` and `searchParams` props typed as `Promise<...>` and awaited\n- [ ] All `cookies()` and `headers()` calls have `await`\n- [ ] Using `proxy.ts` not `middleware.ts` for request interception\n- [ ] Every parallel route @slot has a `default.tsx` file\n- [ ] Using `useActionState` not `useFormState` for forms\n",
  "skills/python-core-skills.md": "---\nskill_name: python-core-skills\nversion: \"3.12.0\"\nframework: Python\nlast_verified: \"2025-12-18\"\nalways_attach: true\npriority: 9\ntriggers:\n  - python\n  - py\n  - pyproject\n  - fastapi\n  - flask\n  - django\n  - pandas\n  - numpy\n  - greykite\n  - sklearn\n  - pytorch\n  - tensorflow\n---\n\n<!--\nLLM INSTRUCTION: This is a CORE skill file for Python projects.\nALWAYS apply these rules when generating Python code.\nYour training data contains mixed conventions - ENFORCE PEP 8 naming below.\nKey focus: Naming consistency, type hints, docstrings, Pythonic patterns.\nWhen you see WRONG, that's inconsistent/bad practice. Use CORRECT instead.\n-->\n\n# Python Core Skills (PEP 8 + Modern Best Practices)\n\n> **Target:** Python 3.10+ | **Last Verified:** 2025-12-18\n\n## 1. What AI Models Get Wrong\n\n- **Inconsistent naming** → LLMs switch between `getUserData`, `get_user_data`, `GetUserData` randomly. Python uses snake_case for functions/variables.\n- **Missing type hints** → LLMs omit type annotations. Modern Python requires type hints for maintainability.\n- **Missing docstrings** → LLMs skip documentation. All public functions need docstrings.\n- **CamelCase variables** → LLMs use JavaScript-style `userName` instead of `user_name`.\n- **Single-letter variables** → LLMs use `x`, `d`, `l` instead of descriptive names.\n- **Bare except clauses** → LLMs write `except:` instead of specific exceptions.\n- **Mutable default arguments** → LLMs use `def func(items=[])` causing bugs.\n\n## 2. Naming Convention Rules\n\n### File Naming\n\n| Type | Convention | Example |\n|------|-----------|---------|\n| Modules | `snake_case.py` | `task_manager.py`, `data_utils.py` |\n| Packages | `snake_case/` | `data_processing/`, `ml_models/` |\n| Test files | `test_*.py` | `test_task_manager.py` |\n| Config files | `snake_case.py` | `config.py`, `settings.py` |\n\n### Code Naming\n\n| Type | Convention | Example |\n|------|-----------|---------|\n| Classes | `PascalCase` | `TaskManager`, `DataProcessor` |\n| Functions | `snake_case` | `get_user_data()`, `process_tasks()` |\n| Variables | `snake_case` | `user_name`, `filtered_tasks` |\n| Constants | `UPPER_SNAKE_CASE` | `MAX_RETRIES`, `API_URL` |\n| Private | `_leading_underscore` | `_internal_cache`, `_helper_func()` |\n| Protected | `_single_underscore` | `_protected_method()` |\n| Name mangling | `__double_underscore` | `__private_attr` (rare) |\n| Type variables | `PascalCase` | `T`, `ItemType`, `KeyType` |\n\n## 3. Golden Rules\n\n### DO\n- **Modules: snake_case.py** → `task_manager.py`, `data_utils.py`\n- **Classes: PascalCase** → `TaskManager`, `DataProcessor`\n- **Functions/variables: snake_case** → `get_data()`, `user_name`\n- **Constants: UPPER_SNAKE_CASE** → `MAX_RETRIES`, `DEFAULT_TIMEOUT`\n- **Private: _leading_underscore** → `_internal_func()`, `_cache`\n- **Type hints on all functions** → `def get_user(id: str) -> User:`\n- **Docstrings on all public functions** → Google or NumPy style\n- **Specific exception handling** → `except ValueError as e:`\n- **Use `None` as default, not mutable** → `def func(items: list | None = None):`\n\n### DON'T\n- **Don't use camelCase** → No `getUserData`, use `get_user_data`\n- **Don't use PascalCase for functions** → No `GetUser()`, use `get_user()`\n- **Don't skip type hints** → Always annotate parameters and returns\n- **Don't use single letters** → No `d = {}`, use `data = {}`\n- **Don't use bare except** → No `except:`, specify the exception\n- **Don't use mutable defaults** → No `def func(items=[]):`\n\n## 4. Critical Patterns\n\n### Function and Variable Naming\n\n**WRONG (JavaScript-style):**\n```python\ndef getUserData(userId):  # camelCase (wrong)\n    userName = \"John\"     # camelCase (wrong)\n    return userName\n\nMaxRetries = 3  # PascalCase for constant (wrong)\n```\n\n**CORRECT (PEP 8):**\n```python\ndef get_user_data(user_id: str) -> str:  # snake_case + types\n    user_name = \"John\"                    # snake_case\n    return user_name\n\nMAX_RETRIES = 3  # UPPER_SNAKE_CASE for constants\n```\n\n---\n\n### Class Naming\n\n**WRONG:**\n```python\nclass task_manager:  # snake_case (wrong)\n    pass\n\nclass taskManager:   # camelCase (wrong)\n    pass\n```\n\n**CORRECT:**\n```python\nclass TaskManager:  # PascalCase\n    \"\"\"Manages task operations.\"\"\"\n\n    def __init__(self, config: Config) -> None:\n        self._config = config  # Private attribute\n        self.tasks: list[Task] = []\n```\n\n---\n\n### Type Hints (Required)\n\n**WRONG (No types):**\n```python\ndef process_data(items, threshold):\n    results = []\n    for item in items:\n        if item.value > threshold:\n            results.append(item)\n    return results\n```\n\n**CORRECT (Full types):**\n```python\nfrom typing import Sequence\n\ndef process_data(\n    items: Sequence[DataItem],\n    threshold: float\n) -> list[DataItem]:\n    \"\"\"Process items above threshold.\n\n    Args:\n        items: Sequence of data items to process.\n        threshold: Minimum value threshold.\n\n    Returns:\n        List of items above threshold.\n    \"\"\"\n    results: list[DataItem] = []\n    for item in items:\n        if item.value > threshold:\n            results.append(item)\n    return results\n```\n\n---\n\n### Docstrings (Google Style)\n\n**WRONG (No docstring):**\n```python\ndef calculate_forecast(data, horizon):\n    model = GreyKiteModel()\n    return model.predict(data, horizon)\n```\n\n**CORRECT (Google style docstring):**\n```python\ndef calculate_forecast(\n    data: pd.DataFrame,\n    horizon: int\n) -> pd.DataFrame:\n    \"\"\"Calculate time series forecast using GreyKite.\n\n    Args:\n        data: Historical time series data with 'ds' and 'y' columns.\n        horizon: Number of periods to forecast.\n\n    Returns:\n        DataFrame with forecasted values and confidence intervals.\n\n    Raises:\n        ValueError: If data is missing required columns.\n\n    Example:\n        >>> df = pd.DataFrame({'ds': dates, 'y': values})\n        >>> forecast = calculate_forecast(df, horizon=30)\n    \"\"\"\n    model = GreyKiteModel()\n    return model.predict(data, horizon)\n```\n\n---\n\n### Exception Handling\n\n**WRONG (Bare except):**\n```python\ntry:\n    result = process_data(items)\nexcept:  # Catches everything including KeyboardInterrupt!\n    result = None\n```\n\n**CORRECT (Specific exceptions):**\n```python\ntry:\n    result = process_data(items)\nexcept ValueError as e:\n    logger.error(f\"Invalid data: {e}\")\n    result = None\nexcept ConnectionError as e:\n    logger.error(f\"Connection failed: {e}\")\n    raise\n```\n\n---\n\n### Mutable Default Arguments\n\n**WRONG (Mutable default):**\n```python\ndef add_item(item: str, items: list = []) -> list:  # BUG!\n    items.append(item)\n    return items\n\n# Bug: items list persists between calls!\nadd_item(\"a\")  # ['a']\nadd_item(\"b\")  # ['a', 'b'] - unexpected!\n```\n\n**CORRECT (None default):**\n```python\ndef add_item(item: str, items: list[str] | None = None) -> list[str]:\n    if items is None:\n        items = []\n    items.append(item)\n    return items\n\n# Correct behavior\nadd_item(\"a\")  # ['a']\nadd_item(\"b\")  # ['b'] - fresh list each time\n```\n\n---\n\n### Private and Protected Members\n\n**WRONG (No convention):**\n```python\nclass DataProcessor:\n    def __init__(self):\n        self.cache = {}        # Public? Private?\n        self.helper_func()     # Internal? External?\n```\n\n**CORRECT (Clear convention):**\n```python\nclass DataProcessor:\n    \"\"\"Process data with caching.\"\"\"\n\n    def __init__(self) -> None:\n        self._cache: dict[str, Any] = {}  # Private (single underscore)\n        self._initialize()\n\n    def process(self, data: Data) -> Result:\n        \"\"\"Public API method.\"\"\"\n        return self._transform(data)\n\n    def _transform(self, data: Data) -> Result:\n        \"\"\"Private helper method.\"\"\"\n        return Result(data)\n\n    def _initialize(self) -> None:\n        \"\"\"Private initialization.\"\"\"\n        self._cache.clear()\n```\n\n## 5. Module Structure Template\n\n```python\n# File: task_processor.py\n\"\"\"Task processing module.\n\nThis module provides utilities for processing and validating tasks.\n\nExample:\n    >>> processor = TaskProcessor(config)\n    >>> result = processor.process(task)\n\"\"\"\n\nfrom __future__ import annotations\n\nimport logging\nfrom dataclasses import dataclass\nfrom typing import TYPE_CHECKING\n\nif TYPE_CHECKING:\n    from .config import Config\n\n# Constants\nMAX_RETRIES = 3\nDEFAULT_TIMEOUT = 30.0\n\n# Module logger\nlogger = logging.getLogger(__name__)\n\n\n@dataclass\nclass ProcessResult:\n    \"\"\"Result of task processing.\n\n    Attributes:\n        success: Whether processing succeeded.\n        data: Processed data if successful.\n        error: Error message if failed.\n    \"\"\"\n\n    success: bool\n    data: dict | None = None\n    error: str | None = None\n\n\nclass TaskProcessor:\n    \"\"\"Process tasks with retry logic.\n\n    Args:\n        config: Configuration object.\n        max_retries: Maximum retry attempts.\n    \"\"\"\n\n    def __init__(\n        self,\n        config: Config,\n        max_retries: int = MAX_RETRIES\n    ) -> None:\n        self._config = config\n        self._max_retries = max_retries\n        self._cache: dict[str, ProcessResult] = {}\n\n    def process(self, task: Task) -> ProcessResult:\n        \"\"\"Process a single task.\n\n        Args:\n            task: Task to process.\n\n        Returns:\n            ProcessResult with success status and data.\n\n        Raises:\n            ValueError: If task is invalid.\n        \"\"\"\n        if not task.is_valid():\n            raise ValueError(f\"Invalid task: {task.id}\")\n\n        return self._execute_with_retry(task)\n\n    def _execute_with_retry(self, task: Task) -> ProcessResult:\n        \"\"\"Execute task with retry logic.\"\"\"\n        for attempt in range(self._max_retries):\n            try:\n                result = self._execute(task)\n                return ProcessResult(success=True, data=result)\n            except ConnectionError as e:\n                logger.warning(f\"Attempt {attempt + 1} failed: {e}\")\n\n        return ProcessResult(success=False, error=\"Max retries exceeded\")\n\n    def _execute(self, task: Task) -> dict:\n        \"\"\"Execute task processing.\"\"\"\n        # Implementation\n        return {\"processed\": True}\n```\n\n## 6. Quick Reference Table\n\n| Category | Convention | Examples |\n|----------|-----------|----------|\n| **Module files** | `snake_case.py` | `task_manager.py`, `data_utils.py` |\n| **Package dirs** | `snake_case/` | `data_processing/`, `ml_models/` |\n| **Classes** | `PascalCase` | `TaskManager`, `DataProcessor` |\n| **Functions** | `snake_case` | `get_user_data()`, `process_tasks()` |\n| **Variables** | `snake_case` | `user_name`, `filtered_items` |\n| **Constants** | `UPPER_SNAKE_CASE` | `MAX_RETRIES`, `API_URL` |\n| **Private** | `_underscore` | `_cache`, `_helper()` |\n| **Type vars** | `PascalCase` | `T`, `ItemType`, `KeyType` |\n| **Test files** | `test_*.py` | `test_processor.py` |\n\n## 7. Checklist Before Coding\n\n- [ ] Module files use snake_case.py\n- [ ] Classes use PascalCase\n- [ ] Functions and variables use snake_case\n- [ ] Constants use UPPER_SNAKE_CASE\n- [ ] Private members use _leading_underscore\n- [ ] All functions have type hints (params + return)\n- [ ] All public functions have docstrings (Google style)\n- [ ] No mutable default arguments (use None)\n- [ ] Specific exception handling (no bare except)\n- [ ] Imports organized: stdlib, third-party, local\n\n## 8. Common Mistakes\n\n```python\n# WRONG: camelCase\ndef getUserData(userId):\n    userName = data[userId]\n\n# CORRECT: snake_case\ndef get_user_data(user_id: str) -> str:\n    user_name = data[user_id]\n```\n\n```python\n# WRONG: mutable default\ndef add(item, items=[]):\n    items.append(item)\n\n# CORRECT: None default\ndef add(item: str, items: list | None = None) -> list:\n    if items is None:\n        items = []\n    items.append(item)\n```\n\n```python\n# WRONG: bare except\ntry:\n    result = fetch()\nexcept:\n    pass\n\n# CORRECT: specific exception\ntry:\n    result = fetch()\nexcept ConnectionError as e:\n    logger.error(e)\n```\n\n```python\n# WRONG: no types\ndef process(data, threshold):\n    return [x for x in data if x > threshold]\n\n# CORRECT: full types\ndef process(data: list[float], threshold: float) -> list[float]:\n    return [x for x in data if x > threshold]\n```\n\n## 9. ML/Data Science Conventions\n\nFor GreyKite, pandas, sklearn projects:\n\n```python\n# DataFrame variables: descriptive names\ndf_raw = pd.read_csv(\"data.csv\")      # Not: df, d, data\ndf_cleaned = clean_data(df_raw)        # Not: df2, clean\ndf_features = extract_features(df_cleaned)\n\n# Model variables\nmodel_forecast = GreykiteModel()       # Not: m, model\nmodel_classifier = RandomForestClassifier()\n\n# Column names: snake_case strings\ndf.columns = [\"user_id\", \"created_at\", \"value\"]  # Not: userId, CreatedAt\n\n# Function naming for ML\ndef train_model(df_train: pd.DataFrame) -> Model:\ndef evaluate_model(model: Model, df_test: pd.DataFrame) -> Metrics:\ndef generate_forecast(model: Model, horizon: int) -> pd.DataFrame:\n```\n",
  "skills/react-core-skills.md": "---\nskill_name: react-core-skills\nversion: \"19.0.0\"\nframework: React\ntypescript_version: \"5.x\"\nlast_verified: \"2025-12-18\"\nalways_attach: true\npriority: 9\ntriggers:\n  - react\n  - tsx\n  - jsx\n  - component\n  - hooks\n  - usestate\n  - useeffect\n  - typescript\n---\n\n<!--\nLLM INSTRUCTION: This is a CORE skill file for React + TypeScript projects.\nALWAYS apply these rules when generating React/TypeScript code.\nYour training data contains mixed conventions - ENFORCE consistent naming below.\nKey focus: Naming consistency, component patterns, TypeScript safety, hooks best practices.\nWhen you see WRONG, that's inconsistent/bad practice. Use CORRECT instead.\n-->\n\n# React + TypeScript Core Skills\n\n> **Target:** React 19+ | **TypeScript:** 5.x | **Last Verified:** 2025-12-18\n\n## 1. What AI Models Get Wrong\n\n- **Inconsistent file naming** → LLMs randomly switch between `UserProfile.tsx`, `user-profile.tsx`, `user_profile.tsx` in the same project. Pick ONE convention and stick to it.\n- **Mixed variable naming** → LLMs use `userName`, `user_name`, `UserName` interchangeably. TypeScript/React uses camelCase for variables.\n- **Prop interfaces without suffix** → LLMs create `interface User` when it should be `UserProps` to distinguish from data types.\n- **Default exports without component name** → LLMs write `export default function() {}` losing type information.\n- **Using `any` type** → LLMs default to `any` when types are unclear. Always use proper types or `unknown`.\n- **Hooks outside components** → LLMs call hooks in helper functions or conditionally.\n- **Missing key prop** → LLMs forget `key` in `.map()` causing React warnings.\n\n## 2. Naming Convention Rules\n\n### File Naming\n\n| Type | Convention | Example |\n|------|-----------|---------|\n| Components | `PascalCase.tsx` | `TaskCard.tsx`, `UserProfile.tsx` |\n| Hooks | `useCamelCase.ts` | `useTaskData.ts`, `useKeyboard.ts` |\n| Services/Utils | `kebab-case.ts` | `task-service.ts`, `date-utils.ts` |\n| Types | `kebab-case.ts` or `PascalCase.ts` | `task.ts`, `filters.ts` |\n| Constants | `kebab-case.ts` | `constants.ts`, `api-endpoints.ts` |\n\n### Code Naming\n\n| Type | Convention | Example |\n|------|-----------|---------|\n| Components | `PascalCase` | `TaskCard`, `UserProfile` |\n| Props interfaces | `{Component}Props` | `TaskCardProps`, `UserProfileProps` |\n| Hooks | `useCamelCase` | `useTaskData()`, `useLocalStorage()` |\n| Variables | `camelCase` | `filteredTasks`, `isLoading` |\n| Functions | `camelCase` | `handleClick`, `formatDate` |\n| Constants | `UPPER_SNAKE_CASE` | `MAX_ITEMS`, `API_URL` |\n| Types/Interfaces | `PascalCase` | `Task`, `User`, `FilterState` |\n| Enums | `PascalCase` | `Status`, `Priority` |\n| CSS classes | `kebab-case` | `task-card`, `btn-primary` |\n\n## 3. Golden Rules\n\n### DO\n- **Component files: PascalCase.tsx** → `TaskCard.tsx`, `UserProfile.tsx`\n- **Props interfaces: {Component}Props** → `interface TaskCardProps`\n- **Hooks: use + PascalCase** → `useTaskData`, `useKeyboard`\n- **Variables/functions: camelCase** → `filteredTasks`, `handleClick`\n- **Constants: UPPER_SNAKE_CASE** → `MAX_ITEMS`, `DEFAULT_TIMEOUT`\n- **CSS classes: kebab-case** → `task-card`, `user-profile`\n- **One component per file** → File exports single component matching filename\n- **Type all props and state** → No implicit `any`\n- **Hooks at top level** → Never conditional, never in loops\n\n### DON'T\n- **Don't mix naming conventions** → No `user-profile.tsx` and `UserSettings.tsx` together\n- **Don't use `any` type** → Use `unknown` or define proper types\n- **Don't call hooks conditionally** → No `if (x) { useState() }`\n- **Don't mutate state directly** → Use setState, never `state.x = y`\n- **Don't use index as key** → Use `key={item.id}` not `key={index}`\n\n## 4. Critical Patterns\n\n### File and Component Naming\n\n**WRONG (Inconsistent):**\n```typescript\n// Mixed conventions in same project\nuser-profile.tsx          // kebab-case\nTaskCard.tsx             // PascalCase\nuser_settings.tsx        // snake_case\n\nexport default function() { ... }  // Anonymous\n```\n\n**CORRECT (Consistent):**\n```typescript\n// All components: PascalCase.tsx\nUserProfile.tsx\nTaskCard.tsx\nUserSettings.tsx\n\n// File: UserProfile.tsx\ninterface UserProfileProps {\n  userId: string;\n  onUpdate: (user: User) => void;\n}\n\nexport function UserProfile({ userId, onUpdate }: UserProfileProps) {\n  return <div>...</div>;\n}\n```\n\n---\n\n### Variable and Function Naming\n\n**WRONG (Inconsistent):**\n```typescript\nconst UserName = 'John';        // PascalCase (wrong)\nconst user_email = 'john@...';  // snake_case (wrong)\nconst HandleClick = () => {};   // PascalCase (wrong)\n```\n\n**CORRECT (Consistent):**\n```typescript\nconst userName = 'John';           // camelCase\nconst userEmail = 'john@...';      // camelCase\nconst handleClick = () => {};      // camelCase\n\nconst MAX_RETRIES = 3;             // UPPER_SNAKE_CASE for constants\nconst DEFAULT_TIMEOUT = 5000;\n```\n\n---\n\n### Props Interface Naming\n\n**WRONG (Ambiguous):**\n```typescript\ninterface Task {  // Is this data or props?\n  onComplete: () => void;\n}\n\nfunction TaskCard(props: any) {  // No type safety\n  return <div>{props.task.title}</div>;\n}\n```\n\n**CORRECT (Clear):**\n```typescript\n// Data type\ninterface Task {\n  id: string;\n  title: string;\n}\n\n// Props type (suffix: Props)\ninterface TaskCardProps {\n  task: Task;\n  onComplete: (id: string) => void;\n}\n\nfunction TaskCard({ task, onComplete }: TaskCardProps) {\n  return <div>{task.title}</div>;\n}\n```\n\n---\n\n### Hook Naming and Usage\n\n**WRONG:**\n```typescript\nfunction taskData() {  // Missing 'use' prefix\n  return useState([]);\n}\n\nfunction TaskList() {\n  if (condition) {\n    const [data] = useState([]);  // Conditional hook!\n  }\n}\n```\n\n**CORRECT:**\n```typescript\nexport function useTaskData() {  // use + PascalCase\n  const [data, setData] = useState<Task[]>([]);\n  return { data, setData };\n}\n\nfunction TaskList() {\n  const [data] = useState<Task[]>([]);  // Top level\n  if (!data) return null;  // Conditional RENDER, not hook\n  return <div>...</div>;\n}\n```\n\n---\n\n### CSS Class Naming\n\n**WRONG (Inconsistent):**\n```typescript\n<div className=\"TaskCard\">        // PascalCase\n<div className=\"task_card\">       // snake_case\n<div className=\"taskcard\">        // no separator\n```\n\n**CORRECT (Consistent):**\n```typescript\n<div className=\"task-card\">           // kebab-case\n  <h2 className=\"task-card-title\">    // kebab-case\n  <div className=\"task-card-actions\"> // kebab-case\n```\n\n## 5. Component Structure Template\n\n```typescript\n// File: TaskCard.tsx\nimport { useState } from 'react';\nimport type { Task } from '@/types/task';\nimport './TaskCard.css';\n\n// Constants\nconst MAX_TITLE_LENGTH = 100;\n\n// Props interface\ninterface TaskCardProps {\n  task: Task;\n  onEdit?: (task: Task) => void;\n  onDelete?: (id: string) => void;\n}\n\n// Component\nexport function TaskCard({ task, onEdit, onDelete }: TaskCardProps) {\n  // Hooks at top\n  const [isExpanded, setIsExpanded] = useState(false);\n\n  // Handlers\n  const handleEdit = () => onEdit?.(task);\n  const handleDelete = () => onDelete?.(task.id);\n\n  // Early returns\n  if (!task) return null;\n\n  // Render\n  return (\n    <div className=\"task-card\">\n      <h3 className=\"task-card-title\">{task.title}</h3>\n      <div className=\"task-card-actions\">\n        <button onClick={handleEdit}>Edit</button>\n        <button onClick={handleDelete}>Delete</button>\n      </div>\n    </div>\n  );\n}\n```\n\n## 6. Quick Reference Table\n\n| Category | Convention | Examples |\n|----------|-----------|----------|\n| **Component files** | `PascalCase.tsx` | `TaskCard.tsx`, `UserProfile.tsx` |\n| **Component names** | `PascalCase` | `TaskCard`, `UserProfile` |\n| **Props interfaces** | `{Component}Props` | `TaskCardProps`, `UserProfileProps` |\n| **Hook files** | `useCamelCase.ts` | `useTaskData.ts`, `useKeyboard.ts` |\n| **Hook functions** | `useCamelCase` | `useTaskData()`, `useLocalStorage()` |\n| **Variables** | `camelCase` | `filteredTasks`, `isLoading` |\n| **Functions** | `camelCase` | `handleClick`, `formatDate` |\n| **Constants** | `UPPER_SNAKE_CASE` | `MAX_ITEMS`, `API_URL` |\n| **Types/Interfaces** | `PascalCase` | `Task`, `User`, `FilterState` |\n| **CSS classes** | `kebab-case` | `task-card`, `btn-primary` |\n| **Service files** | `kebab-case.ts` | `task-service.ts`, `date-utils.ts` |\n\n## 7. Checklist Before Coding\n\n- [ ] Component files use PascalCase.tsx\n- [ ] Component names match filename\n- [ ] Props have {Component}Props interface\n- [ ] Hooks use 'use' prefix, called at top level\n- [ ] Variables use camelCase, constants use UPPER_SNAKE_CASE\n- [ ] CSS classes use kebab-case\n- [ ] No `any` types\n- [ ] List items have unique `key` prop (not index)\n- [ ] Event handlers are typed (React.MouseEvent, etc.)\n\n## 8. Common Mistakes\n\n```typescript\n// WRONG: index as key\n{tasks.map((task, i) => <TaskCard key={i} />)}\n\n// CORRECT: unique ID\n{tasks.map((task) => <TaskCard key={task.id} />)}\n```\n\n```typescript\n// WRONG: state mutation\nitems.push(newItem);\n\n// CORRECT: immutable update\nsetItems([...items, newItem]);\n```\n\n```typescript\n// WRONG: conditional hook\nif (show) { const [x] = useState(); }\n\n// CORRECT: conditional render\nconst [x] = useState();\nif (!show) return null;\n```\n",
  "skills/skill-caching-data-fetching.md": "---\nskill_name: skill-caching-data-fetching\nversion: \"16.0.10\"\nframework: Next.js\nlast_verified: \"2025-12-18\"\nalways_attach: false\npriority: 8\ntriggers:\n  - cache\n  - fetch\n  - revalidate\n  - cacheTag\n  - cacheLife\n  - use cache\n  - unstable_cache\n  - ISR\n  - PPR\n  - stale data\n  - performance\n---\n\n<!--\nLLM INSTRUCTION: Apply when user mentions caching, data fetching, or performance.\nCRITICAL CHANGE: Next.js 16 is UNCACHED BY DEFAULT. fetch() does NOT cache.\nDo NOT use: unstable_cache, revalidate: 60 in fetch options.\nDO use: 'use cache' directive, cacheLife() profiles, cacheTag() for invalidation.\nYour v14 training assumed fetch cached by default - that's WRONG for v16.\n-->\n\n# Caching & Data Fetching\n\n> **Target:** Next.js 16.0.10 | **React:** 19 | **Last Verified:** 2025-12-18\n\n## 1. What AI Models Get Wrong\n\n- **Assuming fetch caches by default** → LLMs expect v14 behavior where fetch was cached. In v16, fetch is uncached by default.\n- **Using `unstable_cache`** → LLMs suggest this deprecated API. In v16, use `'use cache'` directive instead.\n- **Using `revalidate: 60` in fetch options** → LLMs still use this pattern. v16 prefers `'use cache'` with `cacheLife` profiles.\n- **Expecting Route Handler GET to be static** → LLMs assume GET routes cache. In v16, they're dynamic by default.\n- **Trying to cache in proxy.ts** → LLMs attempt fetch caching in proxy. This is explicitly not supported.\n\n## 2. Golden Rules\n\n### ✅ DO\n- **Use `'use cache'` directive** → Opt-in caching for functions or files\n- **Use `cacheLife` profiles** → Semantic durations: `seconds`, `minutes`, `hours`, `days`, `weeks`, `max`\n- **Use `cacheTag` for invalidation** → Tag cached data for targeted revalidation\n- **Wrap dynamic content in `<Suspense>`** → Enables PPR static shell + streaming\n- **Call `revalidateTag` after mutations** → Purge cache in Server Actions\n\n### ❌ DON'T  \n- **Don't assume fetch is cached** → v16 defaults to uncached\n- **Don't use `unstable_cache`** → Deprecated, replaced by `'use cache'`\n- **Don't cache in proxy.ts** → Explicitly unsupported, all fetches run every request\n- **Don't use `getStaticProps` patterns** → Not available in App Router\n- **Don't forget UI refresh after mutations** → Use `router.refresh()` or revalidation\n\n## 3. Critical Patterns\n\n### Use Cache Directive\n\n**❌ WRONG (v14/v15 - Hallucination Risk):**\n```typescript\n// Assuming fetch caches automatically\nexport async function getProduct(id: string) {\n  const res = await fetch(`https://api.example.com/products/${id}`); // Not cached in v16!\n  return res.json();\n}\n\n// Or using deprecated unstable_cache\nimport { unstable_cache } from 'next/cache';\nconst getData = unstable_cache(async () => {\n  return { ok: true };\n}); // Deprecated\n```\n\n**✅ CORRECT (v16):**\n```typescript\nimport { cacheLife } from 'next/cache';\n\nexport async function getProduct(id: string) {\n  'use cache'; // Directive enables caching\n  cacheLife('hours'); // Use semantic profile\n  \n  const res = await fetch(`https://api.example.com/products/${id}`);\n  return res.json();\n}\n```\n**Why:** v16 inverts caching—uncached by default, explicit opt-in required.\n\n---\n\n### CacheLife Profiles\n\n**❌ WRONG (v14/v15 - Hallucination Risk):**\n```typescript\n// Using arbitrary seconds in fetch options\nconst res = await fetch(url, { \n  next: { revalidate: 3600 } // Old pattern\n});\n```\n\n**✅ CORRECT (v16):**\n```typescript\nimport { cacheLife } from 'next/cache';\n\nexport async function getMarketingData() {\n  'use cache';\n  cacheLife('hours'); // Built-in: seconds, minutes, hours, days, weeks, max\n  \n  return fetch('https://api.example.com/marketing').then(r => r.json());\n}\n\n// Custom profiles in next.config.ts\nconst nextConfig: NextConfig = {\n  cacheLife: {\n    'marketing-pages': {\n      stale: 3600,      // Serve stale up to 1 hour\n      revalidate: 900,  // Check for updates every 15 mins\n      expire: 86400,    // Hard expire after 1 day\n    },\n  },\n};\n```\n**Why:** Semantic profiles are clearer and integrate with Next's SWR system.\n\n---\n\n### Tag-Based Invalidation\n\n**❌ WRONG (v14/v15 - Hallucination Risk):**\n```typescript\n// Not tagging data for invalidation\nasync function getPosts() {\n  return fetch('https://api.example.com/posts'); // No way to selectively invalidate\n}\n```\n\n**✅ CORRECT (v16):**\n```typescript\nimport { cacheTag, revalidateTag } from 'next/cache';\n\n// Tag the cached data\nasync function getPosts() {\n  'use cache';\n  cacheTag('posts'); // Tag for invalidation\n  return db.posts.findMany();\n}\n\n// Invalidate in Server Action\n'use server';\nexport async function createPost(data: FormData) {\n  await db.posts.create({\n    title: String(data.get('title') ?? ''),\n    body: String(data.get('body') ?? ''),\n  });\n  revalidateTag('posts'); // Purge cache\n}\n```\n**Why:** Tags enable surgical cache invalidation without full revalidation.\n\n---\n\n### Partial Prerendering (PPR)\n\n**❌ WRONG (v14/v15 - Hallucination Risk):**\n```typescript\n// No Suspense boundary - entire page becomes dynamic\nexport default async function Page() {\n  const user = await getCurrentUser(); // Dynamic - cookies\n  const products = await getProducts(); // Could be static\n  \n  return (\n    <div>\n      <UserGreeting user={user} />\n      <ProductList products={products} />\n    </div>\n  ); // Entire page is dynamic\n}\n```\n\n**✅ CORRECT (v16):**\n```typescript\nimport { Suspense } from 'react';\n\nexport default function Page() {\n  return (\n    <main>\n      <h1>Static Title (Instant Load)</h1>\n      <ProductList /> {/* Can be cached */}\n      \n      <Suspense fallback={<p>Loading user...</p>}>\n        <UserProfile /> {/* Dynamic - streams in */}\n      </Suspense>\n    </main>\n  );\n}\n```\n**Why:** PPR sends static shell immediately, streams dynamic \"holes\" via Suspense.\n\n---\n\n### Route Handler Caching\n\n**❌ WRONG (v14/v15 - Hallucination Risk):**\n```typescript\n// Assuming GET is cached/static\nexport async function GET() {\n  const data = await db.query('SELECT * FROM items');\n  return Response.json(data); // Dynamic in v16!\n}\n```\n\n**✅ CORRECT (v16):**\n```typescript\n// Explicitly set caching behavior\nexport const dynamic = 'force-static'; // Or use 'use cache'\n\nexport async function GET() {\n  'use cache';\n  cacheLife('minutes');\n  \n  const data = await db.query('SELECT * FROM items');\n  return Response.json(data);\n}\n```\n**Why:** GET routes are uncached by default in v16. Explicit opt-in required.\n\n## 4. Quick Reference Table\n\n| Feature | ❌ Don't | ✅ Do |\n|---------|---------|------|\n| Cache Data | Assume cached | Use `'use cache'` directive |\n| Revalidation | `revalidate: 60` in fetch | `cacheLife('minutes')` |\n| Old Cache API | `unstable_cache()` | `'use cache'` directive |\n| Invalidation | `revalidatePath` only | `cacheTag()` + `revalidateTag()` |\n| GET Routes | Assume static | Set `dynamic = 'force-static'` |\n| Dynamic Data | No Suspense | Wrap in `<Suspense>` for PPR |\n| Proxy.ts | Attempt caching | Move caching logic to pages |\n\n## 5. Checklist Before Coding\n\n- [ ] Enable `cacheComponents: true` in next.config.ts (default in 16.0.10)\n- [ ] Add `'use cache'` directive to functions that should be cached\n- [ ] Use semantic `cacheLife` profiles instead of raw seconds\n- [ ] Tag cached data with `cacheTag()` for selective invalidation\n- [ ] Call `revalidateTag()` in Server Actions after mutations\n- [ ] Wrap dynamic components in `<Suspense>` for PPR benefits\n",
  "skills/skill-drizzle-orm.md": "---\nskill_name: skill-drizzle-orm\nversion: \"1.x\"\nframework: Node.js\nlast_verified: \"2025-12-26\"\nalways_attach: false\npriority: 6\ntriggers:\n  - drizzle\n  - drizzle-orm\n  - drizzle-kit\n  - pgTable\n  - jsonb\n  - $type\n  - db:push\n  - db:generate\n  - db:migrate\n  - migration\n  - postgres\n  - postgresql\n---\n\n<!--\nLLM INSTRUCTION: Use for PostgreSQL + Drizzle ORM. Avoid Prisma/TypeORM patterns.\nSchema lives in TypeScript with pgTable. Indexes defined in the pgTable callback.\nUse jsonb.$type<T>() for compile-time typing only (no runtime validation).\nUse pg Pool with a single shared connection pool.\nMigrations: db:push for dev; db:generate + db:migrate for prod.\nAdvanced indexes (GIN/where/using) may require custom SQL migrations.\n-->\n\n# Drizzle ORM (PostgreSQL)\n\n> **Target:** Drizzle ORM + PostgreSQL | **Last Verified:** 2025-12-26\n\n## 1. What AI Models Get Wrong\n\n- **Mixing ORMs** (Prisma schema, TypeORM decorators).\n- **Missing pgTable callback** for indexes/constraints.\n- **Assuming $type validates at runtime** (it does not).\n- **Creating a Pool per request** instead of a shared Pool.\n- **Using db:push in prod** instead of migrations.\n\n## 2. Golden Rules\n\n### ✅ DO\n- **Define schema in TS** with `pgTable` and column builders.\n- **Use jsonb.$type<T>()** to lock TypeScript types (compile-time only).\n- **Define indexes** in the `pgTable(..., (t) => [ ... ])` callback.\n- **Use a shared `pg.Pool`** and pass it to `drizzle({ client: pool })`.\n- **Dev:** `db:push`. **Prod:** `db:generate` + `db:migrate`.\n\n### ❌ DON'T\n- **Don't add Prisma/TypeORM files** (`schema.prisma`, `@Entity()`).\n- **Don't expect $type to validate data** at runtime.\n- **Don't rely on advanced index features** without verifying drizzle-kit output.\n\n## 3. Minimal Setup (Files)\n\n```\nsrc/db/client.ts\nsrc/db/schema.ts\ndrizzle.config.ts\n```\n\n## 4. Core Patterns\n\n### Postgres client (`src/db/client.ts`)\n```ts\nimport { drizzle } from 'drizzle-orm/node-postgres';\nimport { Pool } from 'pg';\nimport * as schema from './schema';\n\nconst pool = new Pool({\n  connectionString: process.env.DATABASE_URL,\n  max: 10,\n  idleTimeoutMillis: 30_000,\n  connectionTimeoutMillis: 2_000\n});\n\nexport const db = drizzle({ client: pool, schema });\n```\n\n### Schema + JSONB typing (`src/db/schema.ts`)\n```ts\nimport { pgTable, text, jsonb, uuid, index } from 'drizzle-orm/pg-core';\n\ntype UserSettings = {\n  theme: 'light' | 'dark';\n  marketingOptIn: boolean;\n};\n\nexport const users = pgTable(\n  'users',\n  {\n    id: uuid('id').defaultRandom().primaryKey(),\n    email: text('email').notNull(),\n    settings: jsonb('settings').$type<UserSettings>().notNull()\n  },\n  (t) => [index('users_email_idx').on(t.email)]\n);\n```\n\n### JSONB query with sql\n```ts\nimport { sql, eq } from 'drizzle-orm';\nimport { users } from './schema';\n\nawait db\n  .select()\n  .from(users)\n  .where(eq(sql`${users.settings} ->> 'theme'`, 'dark'));\n```\n\n### Migration scripts\n```json\n{\n  \"scripts\": {\n    \"db:push\": \"drizzle-kit push\",\n    \"db:generate\": \"drizzle-kit generate\",\n    \"db:migrate\": \"drizzle-kit migrate\"\n  }\n}\n```\n\n## 5. Checklist\n\n- [ ] Schema uses `pgTable` + TS columns.\n- [ ] JSONB uses `.$type<T>()` for compile-time typing.\n- [ ] Indexes defined in the `pgTable` callback.\n- [ ] Shared `pg.Pool` passed to `drizzle`.\n- [ ] Dev uses `db:push`; prod uses `db:generate` + `db:migrate`.\n",
  "skills/skill-http-security-headers.md": "---\nskill_name: skill-http-security-headers\nversion: \"1.0\"\nframework: Next.js\nlast_verified: \"2025-12-26\"\nalways_attach: false\npriority: 8\ntriggers:\n  - csp\n  - content-security-policy\n  - security headers\n  - headers()\n  - next.config\n  - x-frame-options\n  - x-content-type-options\n  - referrer-policy\n  - permissions-policy\n  - clickjacking\n  - xss\n  - nonce\n  - strict-dynamic\n---\n\n<!--\nLLM INSTRUCTION: Use for Next.js HTTP response header hardening.\nPrefer CSP frame-ancestors over X-Frame-Options, but set both for defense-in-depth.\nIf using nonce-based CSP, it must be per-request (not a static next.config.ts string).\nStatic export (output: 'export') cannot use next.config headers(); configure at CDN/host instead.\n-->\n\n# Next.js HTTP Security Headers\n\n> **Target:** Next.js (App Router or Pages Router) | **Last Verified:** 2025-12-26\n\n## 1. What AI Models Get Wrong\n\n- **Static nonce CSP in `next.config.*`** (nonces must be generated per request).\n- **Allowing `unsafe-inline`/`unsafe-eval` in production**.\n- **Using X-Frame-Options alone** (modern control is CSP `frame-ancestors`).\n- **Forgetting static export limits** (`headers()` doesn’t apply to `output: 'export'`).\n- **Over-broad allowlists** (`connect-src *`, `script-src *`) that nullify CSP.\n\n## 2. Golden Rules\n\n### ✅ DO\n- **Set baseline security headers** via `next.config.*` `headers()` when you have a server runtime.\n- **Use CSP `frame-ancestors`** to prevent clickjacking (keep XFO as legacy defense).\n- **Roll out CSP using Report-Only first** if unsure what will break.\n- **Generate CSP nonces per request** when you need strict CSP.\n\n### ❌ DON'T\n- **Don’t ship `unsafe-eval` in production** (dev-only if absolutely required).\n- **Don’t use a single static nonce**.\n- **Don’t rely on `headers()` for static export**.\n\n## 3. Baseline Headers (Good Defaults)\n\nUse these unless a requirement forces deviation:\n\n- `X-Content-Type-Options: nosniff`\n- `Referrer-Policy: strict-origin-when-cross-origin`\n- `Permissions-Policy: camera=(), microphone=(), geolocation=(), payment=(), usb=(), browsing-topics=()`\n- `X-Frame-Options: DENY` (or `SAMEORIGIN` if you must embed yourself)\n- `Content-Security-Policy: ...` (see below)\n\n## 4. Implementing via `next.config.*` (Static Header Values)\n\n```ts\n// next.config.ts\nimport type { NextConfig } from 'next';\n\nconst securityHeaders = [\n  { key: 'X-Content-Type-Options', value: 'nosniff' },\n  { key: 'Referrer-Policy', value: 'strict-origin-when-cross-origin' },\n  {\n    key: 'Permissions-Policy',\n    value: 'camera=(), microphone=(), geolocation=(), payment=(), usb=(), browsing-topics=()'\n  },\n  { key: 'X-Frame-Options', value: 'DENY' }\n];\n\nconst nextConfig: NextConfig = {\n  poweredByHeader: false,\n  async headers() {\n    return [\n      {\n        source: '/:path*',\n        headers: [\n          ...securityHeaders,\n          {\n            key: 'Content-Security-Policy',\n            value: \"default-src 'self'; base-uri 'self'; object-src 'none'; form-action 'self'; frame-ancestors 'none'; img-src 'self' data: blob:; font-src 'self'; connect-src 'self'; upgrade-insecure-requests;\"\n          }\n        ]\n      }\n    ];\n  }\n};\n\nexport default nextConfig;\n```\n\n## 5. CSP: When to Use Nonces\n\nUse nonce-based CSP when you need strong XSS mitigation without allowing inline scripts.\n\n### Strict CSP shape (conceptual)\n\n- `script-src 'self' 'nonce-<NONCE>' 'strict-dynamic'`\n- `style-src 'self' 'nonce-<NONCE>'`\n- keep `frame-ancestors 'none'`, `object-src 'none'`, `base-uri 'self'`, `form-action 'self'`\n\n### Next.js pattern: generate nonce per request\n\n```ts\n// proxy.ts (example)\nimport { NextRequest, NextResponse } from 'next/server';\n\nexport function proxy(request: NextRequest) {\n  const nonce = Buffer.from(crypto.randomUUID()).toString('base64');\n\n  const csp = `default-src 'self'; base-uri 'self'; object-src 'none'; form-action 'self'; frame-ancestors 'none'; script-src 'self' 'nonce-${nonce}' 'strict-dynamic'; style-src 'self' 'nonce-${nonce}'; img-src 'self' data: blob:; font-src 'self'; connect-src 'self'; upgrade-insecure-requests;`;\n\n  const requestHeaders = new Headers(request.headers);\n  requestHeaders.set('x-nonce', nonce);\n\n  const response = NextResponse.next({ request: { headers: requestHeaders } });\n  response.headers.set('Content-Security-Policy', csp);\n  return response;\n}\n```\n\nUse the nonce for third-party scripts:\n\n```tsx\nimport { headers } from 'next/headers';\nimport Script from 'next/script';\n\nexport default async function Page() {\n  const nonce = (await headers()).get('x-nonce') ?? undefined;\n\n  return <Script src=\"https://example.com/script.js\" nonce={nonce} />;\n}\n```\n\n## 6. Static Export Caveat\n\nIf using `output: 'export'`, set headers at the hosting layer (CDN, reverse proxy). `next.config.*` `headers()` won’t apply.\n\n## 7. Checklist\n\n- [ ] Baseline headers set for all routes.\n- [ ] CSP includes `frame-ancestors`.\n- [ ] No `unsafe-eval`/`unsafe-inline` in production.\n- [ ] If using nonces, they are per request and passed to scripts.\n- [ ] Static export handled at CDN/host.\n",
  "skills/skill-metadata-seo.md": "---\nskill_name: skill-metadata-seo\nversion: \"16.0.10\"\nframework: Next.js\nlast_verified: \"2025-12-18\"\nalways_attach: false\npriority: 6\ntriggers:\n  - metadata\n  - generateMetadata\n  - SEO\n  - openGraph\n  - og:image\n  - opengraph-image\n  - sitemap\n  - robots\n  - meta tags\n---\n\n<!--\nLLM INSTRUCTION: Apply when user works on SEO, metadata, or social sharing.\ngenerateMetadata params are PROMISES - must await them.\nopengraph-image.tsx also receives async params.\nDo NOT use next/head - App Router uses export const metadata or generateMetadata.\nUse sitemap.ts and robots.ts for dynamic generation, not static files.\nImage remotePatterns: localhost is BLOCKED by default (SSRF prevention).\n-->\n\n# Metadata & SEO\n\n> **Target:** Next.js 16.0.10 | **React:** 19 | **Last Verified:** 2025-12-18\n\n## 1. What AI Models Get Wrong\n\n- **Using sync params in generateMetadata** → LLMs use `{ params: { id: string } }`. In v16, params is a Promise.\n- **Using `next/head` in App Router** → LLMs suggest the old Head component. App Router uses metadata exports.\n- **Sync params in ImageResponse** → LLMs forget opengraph-image.tsx also receives async params.\n- **Using sitemap.xml file** → LLMs create static XML. v16 prefers sitemap.ts with dynamic generation.\n- **Missing parent metadata extension** → LLMs don't await parent to extend existing metadata.\n\n## 2. Golden Rules\n\n### ✅ DO\n- **Await params in generateMetadata** → First argument is `{ params: Promise<...> }`\n- **Use `export const metadata` or `generateMetadata`** → App Router's metadata API\n- **Await params in opengraph-image.tsx** → Image routes also receive async params\n- **Use sitemap.ts for dynamic sitemaps** → Return `MetadataRoute.Sitemap` array\n- **Await `parent` for extending metadata** → Access parent's openGraph images, etc.\n\n### ❌ DON'T  \n- **Don't use `next/head`** → Not available in App Router\n- **Don't access params synchronously** → They're Promises in generateMetadata\n- **Don't create static sitemap.xml** → Use sitemap.ts for dynamic generation\n- **Don't forget robots.ts** → Controls crawler behavior\n- **Don't use local IPs in remotePatterns** → Blocked by default for SSRF prevention\n\n## 3. Critical Patterns\n\n### Async generateMetadata\n\n**❌ WRONG (v14/v15 - Hallucination Risk):**\n```typescript\nimport type { Metadata } from 'next';\n\n// Sync params - CRASHES in v16\nexport async function generateMetadata({ \n  params \n}: { \n  params: { id: string } // Wrong type\n}): Promise<Metadata> {\n  const product = await fetch(`https://api.example.com/products/${params.id}`); // Error\n  return { title: product.name };\n}\n```\n\n**✅ CORRECT (v16):**\n```typescript\nimport type { Metadata, ResolvingMetadata } from 'next';\n\ntype Props = {\n  params: Promise<{ id: string }>;\n  searchParams: Promise<{ [key: string]: string | string[] | undefined }>;\n};\n\nexport async function generateMetadata(\n  { params, searchParams }: Props,\n  parent: ResolvingMetadata\n): Promise<Metadata> {\n  // 1. Await the params\n  const { id } = await params;\n  \n  // 2. Fetch data\n  const product = await fetch(`https://api.example.com/products/${id}`)\n    .then((res) => res.json());\n\n  // 3. Extend parent metadata\n  const previousImages = (await parent).openGraph?.images || [];\n\n  return {\n    title: product.title,\n    description: product.description,\n    openGraph: {\n      images: [product.image, ...previousImages],\n    },\n  };\n}\n```\n**Why:** v16's async params support PPR and streaming for metadata generation.\n\n---\n\n### OpenGraph Image with Async Params\n\n**❌ WRONG (v14/v15 - Hallucination Risk):**\n```typescript\n// app/blog/[slug]/opengraph-image.tsx\nimport { ImageResponse } from 'next/og';\n\n// Sync params - CRASHES\nexport default function Image({ params }: { params: { slug: string } }) {\n  return new ImageResponse(\n    <div>Post: {params.slug}</div>, // Error\n    { width: 1200, height: 600 }\n  );\n}\n```\n\n**✅ CORRECT (v16):**\n```typescript\n// app/blog/[slug]/opengraph-image.tsx\nimport { ImageResponse } from 'next/og';\n\nexport const runtime = 'edge';\nexport const alt = 'Blog post image';\nexport const size = { width: 1200, height: 630 };\nexport const contentType = 'image/png';\n\nexport default async function Image({ \n  params \n}: { \n  params: Promise<{ slug: string }> \n}) {\n  const { slug } = await params;\n  \n  // Optionally fetch post data\n  const post = await fetch(`https://api.example.com/posts/${slug}`)\n    .then(r => r.json());\n  \n  return new ImageResponse(\n    (\n      <div\n        style={{\n          fontSize: 48,\n          background: 'linear-gradient(to bottom, #1a1a2e, #16213e)',\n          color: 'white',\n          width: '100%',\n          height: '100%',\n          display: 'flex',\n          alignItems: 'center',\n          justifyContent: 'center',\n        }}\n      >\n        {post.title}\n      </div>\n    ),\n    { ...size }\n  );\n}\n```\n**Why:** Image routes follow the same async params pattern as pages.\n\n---\n\n### Dynamic Sitemap\n\n**❌ WRONG (v14/v15 - Hallucination Risk):**\n```xml\n<!-- public/sitemap.xml - Static, outdated -->\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<urlset xmlns=\"http://www.sitemaps.org/schemas/sitemap/0.9\">\n  <url>\n    <loc>https://example.com/</loc>\n  </url>\n</urlset>\n```\n\n**✅ CORRECT (v16):**\n```typescript\n// app/sitemap.ts\nimport { MetadataRoute } from 'next';\n\nexport default async function sitemap(): Promise<MetadataRoute.Sitemap> {\n  const posts = await fetch('https://api.example.com/posts')\n    .then(r => r.json());\n\n  const postUrls = posts.map((post: { slug: string; updatedAt: string }) => ({\n    url: `https://example.com/blog/${post.slug}`,\n    lastModified: new Date(post.updatedAt),\n    changeFrequency: 'weekly' as const,\n    priority: 0.8,\n  }));\n\n  return [\n    {\n      url: 'https://example.com',\n      lastModified: new Date(),\n      changeFrequency: 'yearly',\n      priority: 1,\n    },\n    {\n      url: 'https://example.com/about',\n      lastModified: new Date(),\n      changeFrequency: 'monthly',\n      priority: 0.5,\n    },\n    ...postUrls,\n  ];\n}\n```\n**Why:** sitemap.ts generates dynamic XML at request time with fresh data.\n\n---\n\n### Robots.ts\n\n**❌ WRONG (v14/v15 - Hallucination Risk):**\n```\n# public/robots.txt - Static file\nUser-agent: *\nDisallow: /admin\n```\n\n**✅ CORRECT (v16):**\n```typescript\n// app/robots.ts\nimport { MetadataRoute } from 'next';\n\nexport default function robots(): MetadataRoute.Robots {\n  const baseUrl = process.env.NEXT_PUBLIC_BASE_URL || 'https://example.com';\n  \n  return {\n    rules: [\n      {\n        userAgent: '*',\n        allow: '/',\n        disallow: ['/admin/', '/api/', '/private/'],\n      },\n      {\n        userAgent: 'Googlebot',\n        allow: '/',\n      },\n    ],\n    sitemap: `${baseUrl}/sitemap.xml`,\n    host: baseUrl,\n  };\n}\n```\n**Why:** robots.ts allows dynamic rules and environment-based URLs.\n\n---\n\n### Image Remote Patterns Security\n\n**❌ WRONG (v14/v15 - Hallucination Risk):**\n```typescript\n// next.config.ts\nconst config = {\n  images: {\n    remotePatterns: [\n      { hostname: 'localhost' }, // Blocked for SSRF prevention\n      { hostname: '127.0.0.1' }, // Blocked\n    ],\n  },\n};\n```\n\n**✅ CORRECT (v16):**\n```typescript\n// next.config.ts\nimport type { NextConfig } from 'next';\n\nconst nextConfig: NextConfig = {\n  images: {\n    remotePatterns: [\n      {\n        protocol: 'https',\n        hostname: 'assets.example.com',\n        pathname: '/images/**',\n      },\n      {\n        protocol: 'https',\n        hostname: '*.cloudinary.com',\n      },\n    ],\n    // Only for development - NOT production\n    // dangerouslyAllowLocalIP: true,\n  },\n};\n\nexport default nextConfig;\n```\n**Why:** v16 blocks loopback IPs by default to prevent SSRF attacks.\n\n## 4. Quick Reference Table\n\n| Feature | ❌ Don't | ✅ Do |\n|---------|---------|------|\n| Head Tags | `import Head from 'next/head'` | `export const metadata` or `generateMetadata` |\n| Metadata Params | `params: { id: string }` | `params: Promise<{ id: string }>` |\n| OG Image Params | Sync access | `await params` in async function |\n| Sitemap | Static `sitemap.xml` | Dynamic `sitemap.ts` |\n| Robots | Static `robots.txt` | Dynamic `robots.ts` |\n| Local Images | `localhost` in remotePatterns | Only production domains |\n| Parent Metadata | Ignore parent | `await parent` to extend |\n\n## 5. Checklist Before Coding\n\n- [ ] `generateMetadata` function awaits its `params` argument\n- [ ] `opengraph-image.tsx` is async and awaits params  \n- [ ] Using `export const metadata` or `generateMetadata` (not next/head)\n- [ ] `sitemap.ts` returns `MetadataRoute.Sitemap` array\n- [ ] `robots.ts` returns `MetadataRoute.Robots` object\n- [ ] Image `remotePatterns` only includes production domains (no localhost)\n",
  "skills/skill-next-intl.md": "---\nskill_name: skill-next-intl\nversion: \"3.x\"\nframework: Next.js\nlast_verified: \"2025-12-26\"\nalways_attach: false\npriority: 7\ntriggers:\n  - next-intl\n  - i18n\n  - internationalization\n  - locale\n  - locales\n  - translations\n  - NextIntlClientProvider\n  - setRequestLocale\n  - defineRouting\n  - createNavigation\n  - getRequestConfig\n---\n\n<!--\nLLM INSTRUCTION: Use for Next.js App Router i18n with next-intl.\nCRITICAL: In Next.js 16, params are Promises in layouts/pages. Always await.\nCRITICAL: In async server components, use getTranslations (async) from next-intl/server. NEVER use useTranslations hook in async functions.\nuseTranslations hook is ONLY for client components ('use client').\nAlways call setRequestLocale(locale) in every layout/page that uses params.\nUse NextIntlClientProvider in the root locale layout.\nUse createNavigation() wrappers; never use next/link or next/navigation directly for localized routes.\nDo NOT use next-intl/client or createSharedPathnamesNavigation (deprecated).\n-->\n\n# next-intl (Next.js 16 App Router)\n\n> **Target:** Next.js 16 | **Last Verified:** 2025-12-26\n\n## 1. What AI Models Get Wrong\n\n- **Sync params access** → Next.js 16 params are Promises; sync destructuring breaks.\n- **Missing setRequestLocale** → causes dynamic rendering errors or wrong locale.\n- **Using useTranslations in async server components** → hooks can't be called in async functions; use `getTranslations` from `next-intl/server` instead.\n- **Using next/link** → bypasses localized pathnames.\n- **No NextIntlClientProvider** → client hooks fail.\n- **Missing matcher for unprefixed routes** → localePrefix: 'as-needed' breaks.\n\n## 2. Golden Rules\n\n### ✅ DO\n- **Type params as Promise** and `await` them in layouts/pages.\n- **Call setRequestLocale(locale)** before any server-side translations.\n- **Use `getTranslations` from `next-intl/server`** in async server components (pages/layouts).\n- **Use `useTranslations` from `next-intl`** only in client components (`'use client'`).\n- **Wrap with NextIntlClientProvider** in `[locale]/layout.tsx`.\n- **Use createNavigation wrappers** for Link/redirect/useRouter/usePathname.\n- **Validate locale** with hasLocale and fallback to defaultLocale.\n\n### ❌ DON'T\n- **Don't destructure params synchronously** (`{ params: { locale } }`).\n- **Don't use `useTranslations` in async server components** → use `getTranslations` instead.\n- **Don't import from next-intl/client** (deprecated).\n- **Don't use createSharedPathnamesNavigation** (superseded).\n- **Don't use next/link or next/navigation directly** for localized routes.\n\n## 3. Minimal Setup (Files)\n\n```\nsrc/\n├── i18n/\n│   ├── routing.ts\n│   ├── navigation.ts\n│   └── request.ts\nproxy.ts\n└── app/[locale]/layout.tsx\nmessages/\n└── en.json\n```\n\n## 4. Core Patterns\n\n### Routing (`src/i18n/routing.ts`)\n```ts\nimport { defineRouting } from 'next-intl/routing';\n\nexport const routing = defineRouting({\n  locales: ['en', 'es'],\n  defaultLocale: 'en',\n  localePrefix: 'as-needed',\n  pathnames: {\n    '/': '/',\n    '/about': { en: '/about', es: '/acerca-de' }\n  }\n} as const);\n\nexport type Locale = (typeof routing.locales)[number];\n```\n\n### Navigation (`src/i18n/navigation.ts`)\n```ts\nimport { createNavigation } from 'next-intl/navigation';\nimport { routing } from './routing';\n\nexport const { Link, redirect, usePathname, useRouter, getPathname } =\n  createNavigation(routing);\n```\n\n### Request Config (`src/i18n/request.ts`)\n```ts\nimport { getRequestConfig } from 'next-intl/server';\nimport { hasLocale } from 'next-intl';\nimport { routing } from './routing';\n\nexport default getRequestConfig(async ({ requestLocale }) => {\n  const requested = await requestLocale;\n  const locale = hasLocale(routing.locales, requested)\n    ? requested\n    : routing.defaultLocale;\n\n  return {\n    locale,\n    messages: (await import(`../../messages/${locale}.json`)).default\n  };\n});\n```\n\n### Proxy (`proxy.ts`) — compose with other request interceptors\nIf you also use Supabase SSR (`@supabase/ssr`), run both i18n + session refresh in **one** `proxy.ts`.\n\n```ts\nimport type { NextRequest } from 'next/server';\nimport createIntlMiddleware from 'next-intl/middleware';\nimport { routing } from '@/i18n/routing';\nimport { updateSession } from '@/lib/supabase/proxy';\n\nconst handleI18n = createIntlMiddleware(routing);\n\nexport async function proxy(request: NextRequest) {\n  // 1) Refresh Supabase session (may set cookies)\n  const sessionResponse = await updateSession(request);\n\n  // 2) Apply i18n routing (may rewrite/redirect)\n  const i18nResponse = handleI18n(request);\n\n  // 3) Merge cookies into the final response\n  for (const cookie of sessionResponse.cookies.getAll()) {\n    i18nResponse.cookies.set(cookie);\n  }\n\n  return i18nResponse;\n}\n\nexport const config = {\n  matcher: ['/((?!api|trpc|_next|_vercel|.*\\\\..*).*)']\n};\n```\n\n### Locale Layout (`src/app/[locale]/layout.tsx`)\n```tsx\nimport { NextIntlClientProvider, hasLocale } from 'next-intl';\nimport { getMessages, setRequestLocale } from 'next-intl/server';\nimport { notFound } from 'next/navigation';\nimport { routing } from '@/i18n/routing';\n\nexport function generateStaticParams() {\n  return routing.locales.map((locale) => ({ locale }));\n}\n\nexport default async function LocaleLayout({\n  children,\n  params\n}: {\n  children: React.ReactNode;\n  params: Promise<{ locale: string }>;\n}) {\n  const { locale } = await params;\n  if (!hasLocale(routing.locales, locale)) notFound();\n\n  setRequestLocale(locale);\n  const messages = await getMessages();\n\n  return (\n    <html lang={locale}>\n      <body>\n        <NextIntlClientProvider messages={messages}>\n          {children}\n        </NextIntlClientProvider>\n      </body>\n    </html>\n  );\n}\n```\n\n### Server Component Page (`app/[locale]/page.tsx`)\n```tsx\nimport { getTranslations, setRequestLocale } from 'next-intl/server';\n\nexport default async function HomePage({\n  params\n}: {\n  params: Promise<{ locale: string }>;\n}) {\n  const { locale } = await params;\n  setRequestLocale(locale);\n\n  const t = await getTranslations('HomePage');\n  return <h1>{t('title')}</h1>;\n}\n```\n\n> **Note:** Use `getTranslations` (async) in server components. Use `useTranslations` (hook) only in client components.\n\n### Client Component (`'use client'`)\n```tsx\n'use client';\n\nimport { useTranslations } from 'next-intl';\nimport { Link, usePathname, useRouter } from '@/i18n/navigation';\n\nexport default function Navigation() {\n  const t = useTranslations('Nav');\n  const pathname = usePathname();\n  const router = useRouter();\n\n  return (\n    <nav>\n      <Link href=\"/about\">{t('about')}</Link>\n      <button onClick={() => router.push('/contact')}>{t('contact')}</button>\n    </nav>\n  );\n}\n```\n\n## 5. Checklist\n\n- [ ] Params typed as `Promise` and awaited in layouts/pages.\n- [ ] `setRequestLocale(locale)` called before server translations.\n- [ ] `NextIntlClientProvider` wraps app under `[locale]/layout.tsx`.\n- [ ] Navigation uses `@/i18n/navigation` wrappers.\n- [ ] Proxy matcher includes unprefixed routes.\n",
  "skills/skill-posthog-analytics.md": "---\nskill_name: skill-posthog-analytics\nversion: \"1.0\"\nframework: Next.js\nlast_verified: \"2025-12-26\"\nalways_attach: false\npriority: 5\ntriggers:\n  - posthog\n  - posthog-js\n  - posthog-node\n  - \"@posthog/react\"\n  - analytics\n  - pageview\n  - \"$pageview\"\n  - \"$pageleave\"\n  - autocapture\n  - server-only\n  - client-only\n  - runtime = 'nodejs'\n---\n\n<!--\nLLM INSTRUCTION: Use for PostHog analytics in Next.js App Router.\nStrictly separate client tracking (posthog-js/@posthog/react) from server tracking (posthog-node).\nMark server analytics modules as server-only and client analytics modules as client-only to prevent cross-imports.\nServer tracking must run in Node runtime (not Edge); set export const runtime = 'nodejs' where needed.\nPrefer PostHog SPA pageview auto-tracking; only use manual $pageview/$pageleave when required.\nAlways flush server events in short-lived runtimes (flushAt: 1, flushInterval: 0, shutdown()).\n-->\n\n# PostHog Analytics (Next.js App Router)\n\n> **Target:** Next.js App Router | **Last Verified:** 2025-12-26\n\n## 1. What AI Models Get Wrong\n\n- Importing `posthog-node` into client bundles (causes runtime/bundle issues).\n- Using browser-only APIs on the server (“window is not defined”).\n- Running server tracking in Edge runtime.\n- Double-tracking pageviews (auto + manual).\n- Not flushing server events in serverless/short-lived execution.\n\n## 2. Golden Rules\n\n### ✅ DO\n- **Client:** `posthog-js` + `@posthog/react` in `'use client'` components only.\n- **Server:** `posthog-node` in server-only modules only; flush events on completion.\n- Enforce separation with `import 'server-only'` and optionally `import 'client-only'`.\n- Prefer SPA pageview auto-tracking; standardize one approach.\n- For server handlers/actions using PostHog Node SDK, ensure `export const runtime = 'nodejs'` if your project uses Edge elsewhere.\n\n### ❌ DON'T\n- Don’t import server tracking helpers in client components.\n- Don’t rely on server tracking in Edge.\n- Don’t mix auto and manual pageview capture without a clear reason.\n\n## 3. Environment Variables\n\nClient (public):\n\n```bash\nNEXT_PUBLIC_POSTHOG_KEY=phc_...\nNEXT_PUBLIC_POSTHOG_HOST=https://us.i.posthog.com\n```\n\nServer (keep separate names to avoid accidental client coupling):\n\n```bash\nPOSTHOG_SERVER_KEY=phc_...\nPOSTHOG_SERVER_HOST=https://us.i.posthog.com\n```\n\n## 4. Client Setup (Provider)\n\n```tsx\n// app/providers.tsx\n'use client';\n\nimport { useEffect } from 'react';\nimport posthog from 'posthog-js';\nimport { PostHogProvider as PHProvider } from '@posthog/react';\n\nexport function PostHogProvider({ children }: { children: React.ReactNode }) {\n  useEffect(() => {\n    posthog.init(process.env.NEXT_PUBLIC_POSTHOG_KEY!, {\n      api_host: process.env.NEXT_PUBLIC_POSTHOG_HOST,\n    });\n  }, []);\n\n  return <PHProvider client={posthog}>{children}</PHProvider>;\n}\n```\n\nWrap in `app/layout.tsx` without forcing full client rendering (boundary is fine).\n\n## 5. Pageview Tracking\n\n- Prefer built-in SPA pageview auto-tracking (don’t manually capture unless you disable it).\n- If manual is required:\n  - disable auto (`capture_pageview: false`)\n  - capture both `$pageview` and `$pageleave` (use `sendBeacon` for leave).\n\n## 6. Server Setup (`posthog-node`)\n\n```ts\n// src/lib/posthog-server.ts\nimport 'server-only';\nimport { PostHog } from 'posthog-node';\n\nexport function PostHogServer() {\n  return new PostHog(process.env.POSTHOG_SERVER_KEY!, {\n    host: process.env.POSTHOG_SERVER_HOST!,\n    flushAt: 1,\n    flushInterval: 0\n  });\n}\n```\n\nUse in a route handler/action and `await posthog.shutdown()` in `finally`.\n\n## 7. Standard Event Shape (Recommended)\n\n- Event naming: `[object] [verb]` (e.g. `project created`, `invite sent`).\n- Include these properties on all custom events:\n  - `source: 'client' | 'server'`\n  - `app: 'web'`\n  - `router: 'app'`\n  - domain IDs (`org_id`, `project_id`, etc.)\n\n## 8. Checklist\n\n- [ ] Client and server analytics code is split and enforced via `server-only` / `client-only`.\n- [ ] Server tracking runs in Node runtime and flushes on completion.\n- [ ] Pageview strategy chosen (auto vs manual) and not duplicated.\n- [ ] Custom event naming and core properties standardized.\n",
  "skills/skill-routing-layouts.md": "---\nskill_name: skill-routing-layouts\nversion: \"16.0.10\"\nframework: Next.js\nlast_verified: \"2025-12-18\"\nalways_attach: false\npriority: 7\ntriggers:\n  - parallel route\n  - \"@modal\"\n  - \"@slot\"\n  - default.js\n  - default.tsx\n  - intercepting route\n  - layout.tsx\n  - loading.js\n  - error.js\n  - route group\n---\n\n<!--\nLLM INSTRUCTION: Apply when user creates pages, modals, layouts, or navigation.\nCRITICAL: Every parallel route @slot MUST have a default.tsx file (even if it returns null).\nParams in layouts are ALSO Promises - must await them just like in pages.\nIntercepting routes: (.) = same level, (..) = parent, (...) = root.\nerror.js MUST have 'use client' directive. loading.js is auto-Suspense.\nDo NOT use _app.js, _document.js, or next/router - those are Pages Router patterns.\n-->\n\n# Routing & Layouts\n\n> **Target:** Next.js 16.0.10 | **React:** 19 | **Last Verified:** 2025-12-18\n\n## 1. What AI Models Get Wrong\n\n- **Omitting `default.js` in parallel routes** → LLMs forget this file. v16 build fails without it for every @slot.\n- **Using sync params in layouts** → LLMs access params directly. In v16, layout params are Promises too.\n- **Confusing intercepting route syntax** → LLMs mix up `(.)` vs `(..)` vs `(...)` conventions.\n- **Using Pages Router patterns** → LLMs suggest `_app.js`, `_document.js`, `next/router` in App Router context.\n- **Creating page.tsx AND route.ts in same folder** → LLMs don't realize this causes conflicts.\n\n## 2. Golden Rules\n\n### ✅ DO\n- **Create `default.js` for every parallel route @slot** → Required fallback for soft navigation\n- **Await params in layouts** → Layouts receive `Promise<{ slug: string }>` too\n- **Use `(.)` for same-level intercept, `(..)` for parent** → Precise routing semantics\n- **Use `loading.js` for Suspense boundaries** → Automatic loading UI per segment\n- **error.js must be 'use client'** → Error boundaries are client components\n\n### ❌ DON'T  \n- **Don't skip default.js** → Causes 404 or build failure in v16\n- **Don't access layout params synchronously** → They're Promises\n- **Don't use `_app.js`, `_document.js`** → App Router uses layout.tsx\n- **Don't use `next/router`** → Use `next/navigation` in App Router\n- **Don't have page.tsx and route.ts together** → Same segment conflict\n\n## 3. Critical Patterns\n\n### Parallel Routes with Default.js\n\n**❌ WRONG (v14/v15 - Hallucination Risk):**\n```\napp/\n├── @modal/\n│   └── photo/\n│       └── [id]/\n│           └── page.tsx\n├── layout.tsx\n└── page.tsx\n// Missing default.tsx = BUILD FAILURE in v16\n```\n\n**✅ CORRECT (v16):**\n```\napp/\n├── @modal/\n│   ├── default.tsx      ← REQUIRED\n│   └── photo/\n│       └── [id]/\n│           └── page.tsx\n├── layout.tsx\n└── page.tsx\n```\n\n```typescript\n// app/@modal/default.tsx\nexport default function Default() {\n  return null; // Render nothing when no modal matches\n}\n\n// app/layout.tsx\nexport default function Layout({\n  children,\n  modal,\n}: {\n  children: React.ReactNode;\n  modal: React.ReactNode;\n}) {\n  return (\n    <html>\n      <body>\n        {children}\n        {modal}\n      </body>\n    </html>\n  );\n}\n```\n**Why:** When navigating away from /photo/123, Next needs default.tsx to know what to render in @modal slot.\n\n---\n\n### Async Params in Layouts\n\n**❌ WRONG (v14/v15 - Hallucination Risk):**\n```typescript\n// Sync access in layout - CRASHES\nexport default function BlogLayout({\n  children,\n  params,\n}: {\n  children: React.ReactNode;\n  params: { slug: string }; // Wrong type\n}) {\n  return (\n    <div>\n      <h1>Blog: {params.slug}</h1> {/* Error: params is Promise */}\n      {children}\n    </div>\n  );\n}\n```\n\n**✅ CORRECT (v16):**\n```typescript\nexport default async function BlogLayout({\n  children,\n  params,\n}: {\n  children: React.ReactNode;\n  params: Promise<{ slug: string }>; // Promise type\n}) {\n  const { slug } = await params; // Await required\n  \n  return (\n    <div className=\"blog-layout\">\n      <aside>Current Post: {slug}</aside>\n      {children}\n    </div>\n  );\n}\n```\n**Why:** All params are Promises in v16 to support PPR streaming.\n\n---\n\n### Intercepting Routes Syntax\n\n**❌ WRONG (v14/v15 - Hallucination Risk):**\n```\napp/\n├── feed/\n│   └── (..)photo/      ← Wrong: should match route structure\n│       └── [id]/\n│           └── page.tsx\n└── photo/\n    └── [id]/\n        └── page.tsx\n```\n\n**✅ CORRECT (v16):**\n```\napp/\n├── @modal/\n│   └── (.)photo/       ← (.) = same level intercept\n│       └── [id]/\n│           └── page.tsx\n├── feed/\n│   └── (..)photo/      ← (..) = one level up intercept  \n│       └── [id]/\n│           └── page.tsx\n├── photo/\n│   └── [id]/\n│       └── page.tsx    ← Full page (hard navigation)\n└── layout.tsx\n```\n\n**Syntax Reference:**\n- `(.)` - Intercept from same level\n- `(..)` - Intercept from one level up\n- `(..)(..)` - Two levels up\n- `(...)` - Intercept from app root\n\n**Why:** Soft navigation shows intercepted modal; hard refresh shows full page.\n\n---\n\n### Loading.js and Error.js\n\n**❌ WRONG (v14/v15 - Hallucination Risk):**\n```typescript\n// Manual loading state in page\n'use client';\nexport default function Page() {\n  const [loading, setLoading] = useState(true);\n  // ... manual spinner logic\n}\n\n// error.js as Server Component\nexport default function Error({ error }) { // Missing 'use client'\n  return <div>Error: {error.message}</div>;\n}\n```\n\n**✅ CORRECT (v16):**\n```typescript\n// app/dashboard/loading.tsx - Automatic Suspense\nexport default function Loading() {\n  return <div className=\"skeleton\">Loading dashboard...</div>;\n}\n\n// app/dashboard/error.tsx - MUST be 'use client'\n'use client';\n\nimport { useEffect } from 'react';\n\nexport default function Error({\n  error,\n  reset,\n}: {\n  error: Error & { digest?: string };\n  reset: () => void;\n}) {\n  useEffect(() => {\n    console.error(error);\n  }, [error]);\n\n  return (\n    <div>\n      <h2>Something went wrong!</h2>\n      <button onClick={() => reset()}>Try again</button>\n    </div>\n  );\n}\n```\n**Why:** loading.js auto-wraps in Suspense. error.js must be client for reset() interactivity.\n\n---\n\n### Default.js with Async Params\n\n**❌ WRONG (v14/v15 - Hallucination Risk):**\n```typescript\n// Sync params in default.js\nexport default function Default({ params }: { params: { id: string } }) {\n  return <div>Fallback for {params.id}</div>; // Crashes\n}\n```\n\n**✅ CORRECT (v16):**\n```typescript\n// app/@sidebar/default.tsx\nexport default async function Default({ \n  params \n}: { \n  params: Promise<{ id: string }> \n}) {\n  const { id } = await params;\n  return <div>Default sidebar for {id}</div>;\n}\n```\n**Why:** default.js follows the same async params contract as page.tsx.\n\n## 4. Quick Reference Table\n\n| Feature | ❌ Don't | ✅ Do |\n|---------|---------|------|\n| Parallel Routes | Skip default.js | Create default.js for every @slot |\n| Layout Params | `params: { slug: string }` | `params: Promise<{ slug: string }>` |\n| Same-level Intercept | Random folder | `(.)folder` syntax |\n| Parent-level Intercept | `(.)folder` | `(..)folder` syntax |\n| Error Boundary | Server Component | `'use client'` directive |\n| Loading UI | Manual useState | `loading.js` file |\n| Global Layout | `_app.js` | `app/layout.tsx` |\n| Navigation | `next/router` | `next/navigation` |\n\n## 5. Checklist Before Coding\n\n- [ ] Every parallel route @slot has a `default.tsx` file\n- [ ] Layout components are `async` and `await` their params\n- [ ] Using correct intercept syntax: `(.)` same, `(..)` parent, `(...)` root\n- [ ] `error.js` files have `'use client'` at top\n- [ ] No `_app.js`, `_document.js`, or `next/router` usage\n- [ ] No page.tsx and route.ts in the same folder\n",
  "skills/skill-server-actions-mutations.md": "---\nskill_name: skill-server-actions-mutations\nversion: \"16.0.10\"\nframework: Next.js\nreact_version: \"19\"\nlast_verified: \"2025-12-18\"\nalways_attach: false\npriority: 8\ntriggers:\n  - server action\n  - use server\n  - useActionState\n  - useFormState\n  - form action\n  - FormData\n  - mutation\n  - submit\n  - zod\n  - validation\n---\n\n<!--\nLLM INSTRUCTION: Apply when user creates forms or server-side mutations.\nSECURITY: Server Actions are PUBLIC HTTP endpoints. ALWAYS validate with Zod.\nREACT 19 CHANGE: useFormState is RENAMED to useActionState. Import from 'react' not 'react-dom'.\nCRITICAL: redirect() throws an error intentionally - NEVER catch it in try/catch.\nUse .bind() for passing IDs, NOT hidden inputs (which are tamperable).\n-->\n\n# Server Actions & Mutations\n\n> **Target:** Next.js 16.0.10 | **React:** 19 | **Last Verified:** 2025-12-18\n\n## 1. What AI Models Get Wrong\n\n- **Using `useFormState` from 'react-dom'** → LLMs use React 18 import. React 19 renames to `useActionState` from 'react'.\n- **Skipping Zod validation** → LLMs trust FormData directly. Server Actions are public endpoints—validation is mandatory.\n- **Placing `redirect()` inside try/catch** → LLMs catch the redirect error. redirect() throws intentionally and must not be caught.\n- **Defining actions in 'use client' files** → LLMs put 'use server' inside client components. Actions must be in server files.\n- **Using hidden inputs for IDs** → LLMs use `<input type=\"hidden\">` for passing IDs. Use `.bind()` for secure argument passing.\n\n## 2. Golden Rules\n\n### ✅ DO\n- **Validate ALL input with Zod** → Server Actions are public HTTP endpoints\n- **Use `useActionState` from 'react'** → React 19's renamed hook with isPending\n- **Use `.bind()` for secure argument passing** → Prevents client tampering\n- **Place `redirect()` outside try/catch** → It throws to trigger navigation\n- **Call `revalidateTag()` after mutations** → Update cached data\n\n### ❌ DON'T  \n- **Don't trust FormData** → Always validate server-side\n- **Don't use `useFormState`** → Renamed to useActionState in React 19\n- **Don't catch redirect/notFound errors** → They throw intentionally\n- **Don't define 'use server' in 'use client' files** → Invalid, actions must be separate\n- **Don't use hidden inputs for sensitive IDs** → Use .bind() instead\n\n## 3. Critical Patterns\n\n### Secure Server Action with Zod\n\n**❌ WRONG (v14/v15 - Hallucination Risk):**\n```typescript\n'use server';\n\nexport async function createUser(formData: FormData) {\n  // Trusting raw FormData - SECURITY RISK\n  const email = formData.get('email') as string;\n  const role = formData.get('role') as string;\n  \n  await db.user.create({ email, role }); // No validation!\n}\n```\n\n**✅ CORRECT (v16):**\n```typescript\n'use server';\n\nimport { z } from 'zod';\nimport { auth } from '@/lib/auth';\nimport { redirect } from 'next/navigation';\n\nconst schema = z.object({\n  email: z.string().email(),\n  role: z.enum(['user', 'admin']),\n});\n\ntype CreateUserState =\n  | {\n      error: string;\n      issues?: Record<string, string[]>;\n    }\n  | null;\n\nexport async function createUser(_prevState: CreateUserState, formData: FormData): Promise<CreateUserState> {\n  // 1. Authentication\n  const session = await auth();\n  if (!session?.user) {\n    return { error: 'Unauthorized' };\n  }\n\n  // 2. Validation (MANDATORY)\n  const parsed = schema.safeParse({\n    email: formData.get('email'),\n    role: formData.get('role'),\n  });\n\n  if (!parsed.success) {\n    return { error: 'Invalid input', issues: parsed.error.flatten().fieldErrors };\n  }\n\n  // 3. Mutation\n  try {\n    await db.user.create({ data: parsed.data });\n  } catch (e) {\n    return { error: 'Database error' };\n  }\n\n  // 4. Redirect (OUTSIDE try/catch)\n  redirect('/users');\n}\n```\n**Why:** Server Actions are public endpoints. Zod validation is non-negotiable security.\n\n---\n\n### useActionState (React 19)\n\n**❌ WRONG (v14/React 18 - Hallucination Risk):**\n```typescript\n'use client';\nimport { useFormState } from 'react-dom'; // WRONG import\n\nexport function UserForm() {\n  const [state, action] = useFormState(createUser, null); // Missing isPending\n  \n  return <form action={action}>...</form>;\n}\n```\n\n**✅ CORRECT (v16/React 19):**\n```typescript\n'use client';\nimport { useActionState } from 'react'; // Correct import\nimport { createUser } from './actions';\n\nexport function UserForm() {\n  // React 19: [state, dispatch, isPending]\n  const [state, formAction, isPending] = useActionState(createUser, null);\n\n  return (\n    <form action={formAction}>\n      <input name=\"email\" type=\"email\" required />\n      \n      {state?.issues?.email && (\n        <span className=\"error\">{state.issues.email}</span>\n      )}\n      \n      <button type=\"submit\" disabled={isPending}>\n        {isPending ? 'Creating...' : 'Create User'}\n      </button>\n      \n      {state?.error && <div className=\"error\">{state.error}</div>}\n    </form>\n  );\n}\n```\n**Why:** React 19 renamed useFormState to useActionState and added isPending as third return value.\n\n---\n\n### Secure Argument Binding\n\n**❌ WRONG (v14/v15 - Hallucination Risk):**\n```typescript\n// Hidden inputs can be tampered with in DevTools\nexport function DeleteButton({ userId }: { userId: string }) {\n  return (\n    <form action={deleteUser}>\n      <input type=\"hidden\" name=\"userId\" value={userId} /> {/* Tamperable! */}\n      <button>Delete</button>\n    </form>\n  );\n}\n```\n\n**✅ CORRECT (v16):**\n```typescript\n// Server Component - .bind() is secure\nexport function DeleteButton({ userId }: { userId: string }) {\n  const deleteUserWithId = deleteUser.bind(null, userId);\n  \n  return (\n    <form action={deleteUserWithId}>\n      <button>Delete</button>\n    </form>\n  );\n}\n\n// actions.ts\n'use server';\nexport async function deleteUser(userId: string, formData: FormData) {\n  // userId is bound server-side, client cannot tamper\n  await db.user.delete({ where: { id: userId } });\n  revalidateTag('users');\n}\n```\n**Why:** .bind() serializes arguments in the React Server Components closure, not in client HTML.\n\n---\n\n### Redirect Outside Try/Catch\n\n**❌ WRONG (v14/v15 - Hallucination Risk):**\n```typescript\n'use server';\n\nexport async function submitForm(formData: FormData) {\n  try {\n    await db.insert(formData);\n    redirect('/success'); // CAUGHT by catch block!\n  } catch (e) {\n    return { error: 'Failed' }; // Redirect never happens\n  }\n}\n```\n\n**✅ CORRECT (v16):**\n```typescript\n'use server';\nimport { redirect } from 'next/navigation';\n\nexport async function submitForm(formData: FormData) {\n  let success = false;\n  \n  try {\n    await db.insert(formData);\n    success = true;\n  } catch (e) {\n    return { error: 'Database error' };\n  }\n\n  // Redirect OUTSIDE try/catch\n  if (success) {\n    redirect('/success');\n  }\n}\n```\n**Why:** redirect() throws a NEXT_REDIRECT error to trigger navigation. Catching it prevents the redirect.\n\n---\n\n### useFormStatus for Submit Buttons\n\n**❌ WRONG (v14/v15 - Hallucination Risk):**\n```typescript\n// Prop drilling isPending to button\nexport function Form({ isPending }: { isPending: boolean }) {\n  return (\n    <form>\n      <SubmitButton disabled={isPending} />\n    </form>\n  );\n}\n```\n\n**✅ CORRECT (v16/React 19):**\n```typescript\n'use client';\nimport { useFormStatus } from 'react-dom';\n\nexport function SubmitButton() {\n  const { pending, data, method, action } = useFormStatus();\n  \n  return (\n    <button type=\"submit\" disabled={pending}>\n      {pending ? 'Submitting...' : 'Submit'}\n    </button>\n  );\n}\n\n// Usage - no prop drilling needed\nexport function Form() {\n  return (\n    <form action={submitAction}>\n      <input name=\"email\" />\n      <SubmitButton /> {/* Reads pending from parent form */}\n    </form>\n  );\n}\n```\n**Why:** useFormStatus reads status from the nearest parent form without prop drilling.\n\n## 4. Quick Reference Table\n\n| Feature | ❌ Don't | ✅ Do |\n|---------|---------|------|\n| Form Hook | `useFormState` from 'react-dom' | `useActionState` from 'react' |\n| Validation | Trust raw FormData | Validate with Zod (mandatory) |\n| Pass IDs | `<input type=\"hidden\">` | `.bind(null, id)` |\n| Redirect | Inside try/catch | Outside try/catch block |\n| Action Files | 'use server' in 'use client' file | Separate actions.ts file |\n| Button State | Prop drilling isPending | `useFormStatus` hook |\n| After Mutation | Forget cache | `revalidateTag()` or `router.refresh()` |\n\n## 5. Checklist Before Coding\n\n- [ ] Server Action file has `'use server'` at top (not inside 'use client' file)\n- [ ] All input validated with Zod before any database operations\n- [ ] Using `useActionState` from 'react' (not useFormState from 'react-dom')\n- [ ] `redirect()` and `notFound()` calls are outside try/catch blocks\n- [ ] Using `.bind()` for passing IDs instead of hidden inputs\n- [ ] Calling `revalidateTag()` or `router.refresh()` after mutations\n",
  "skills/skill-supabase-ssr.md": "---\nskill_name: skill-supabase-ssr\nversion: \"1.0\"\nframework: Next.js\nlast_verified: \"2025-12-29\"\nalways_attach: false\npriority: 8\ntriggers:\n  - \"@supabase/ssr\"\n  - supabase ssr\n  - supabase auth\n  - createServerClient\n  - createBrowserClient\n  - proxy.ts\n  - cookies.setAll\n  - next/headers\n  - getUser\n  - getClaims\n  - getSession\n  - rls\n  - auth.uid()\n  - \"@supabase/auth-helpers-nextjs\"\n---\n\n<!--\nLLM INSTRUCTION: Use for Supabase Auth in Next.js App Router with @supabase/ssr.\nFORBID: @supabase/auth-helpers-nextjs (deprecated; don't mix with @supabase/ssr).\nUse separate clients: createBrowserClient (client components) and createServerClient (server).\nServer Components may throw on setting cookies: wrap cookies.setAll in try/catch.\nUse a Proxy (proxy.ts) to refresh sessions and write cookies to BOTH request and response to avoid desync.\nNever rely on getSession() for server-side protection; prefer getClaims() (JWT verification) or getUser() (server revalidation).\nCoordinate RLS policies with schema: policies depend on columns like user_id/tenant_id and auth.uid().\n-->\n\n# Supabase Auth (SSR) for Next.js App Router\n\n> **Target:** Next.js + `@supabase/ssr` | **Last Verified:** 2025-12-29\n\n## 1. What AI Models Get Wrong\n\n- Using `@supabase/auth-helpers-nextjs` (deprecated) or mixing it with `@supabase/ssr`.\n- Creating a server client as a module singleton (can bleed cookie state across requests).\n- Forgetting the Proxy session refresh step (tokens drift; server components can’t reliably set cookies).\n- Not updating both `request.cookies` and `response.cookies` in the Proxy.\n- Trusting `getSession()` for server-side authorization decisions.\n\n## 2. Golden Rules\n\n### ✅ DO\n- Use `@supabase/ssr` only; uninstall `@supabase/auth-helpers-nextjs`.\n- Use **two clients**:\n  - `createBrowserClient` for Client Components.\n  - `createServerClient` for Server Components/Actions/Route Handlers with cookie plumbing.\n- In Server Components, implement `cookies.getAll()` + `cookies.setAll()` and **catch `setAll` errors**.\n- Use `proxy.ts` to refresh sessions early and keep cookies consistent per request.\n- For server-side protection, use `getClaims()` (recommended) or `getUser()` (strongest, revalidated).\n\n### ❌ DON'T\n- Don’t trust `getSession()` in server code for protection.\n- Don’t set cookies in Server Components without guarding for runtime errors.\n- Don’t ship schema changes without matching RLS updates.\n\n## 3. Minimal File Layout\n\n```\nproxy.ts                    # Root Next.js middleware entrypoint\nlib/supabase/client.ts      # Browser client (createBrowserClient)\nlib/supabase/server.ts      # Server client (createServerClient)\nlib/supabase/proxy.ts       # Session refresh with getClaims()\n```\n\n## 4. Client Component: Browser Client\n\n```ts\n// lib/supabase/client.ts\nimport { createBrowserClient } from '@supabase/ssr';\n\nexport function createClient() {\n  return createBrowserClient(\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\n    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!\n  );\n}\n```\n\n## 5. Server: Per-request Client + Cookie Safety\n\n```ts\n// lib/supabase/server.ts\nimport { createServerClient } from '@supabase/ssr';\nimport { cookies } from 'next/headers';\n\nexport function createClient() {\n  const cookieStore = cookies();\n\n  return createServerClient(\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\n    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,\n    {\n      cookies: {\n        getAll() {\n          return cookieStore.getAll();\n        },\n        setAll(cookiesToSet) {\n          try {\n            cookiesToSet.forEach(({ name, value, options }) => {\n              cookieStore.set(name, value, options);\n            });\n          } catch {\n            // Server Components can throw on cookie writes.\n            // Safe to ignore IF proxy.ts refreshes sessions.\n          }\n        }\n      }\n    }\n  );\n}\n```\n\n## 6. Proxy Session Refresh (Required)\n\n### Root `proxy.ts`\n```ts\nimport type { NextRequest } from 'next/server';\nimport { updateSession } from '@/lib/supabase/proxy';\n\nexport async function proxy(request: NextRequest) {\n  return updateSession(request);\n}\n\nexport const config = {\n  matcher: [\n    '/((?!_next/static|_next/image|favicon.ico|.*\\\\.(?:svg|png|jpg|jpeg|gif|webp)$).*)'\n  ]\n};\n```\n\n### Session updater (`lib/supabase/proxy.ts`)\n```ts\nimport { createServerClient } from '@supabase/ssr';\nimport { NextResponse, type NextRequest } from 'next/server';\n\nexport async function updateSession(request: NextRequest) {\n  let response = NextResponse.next({ request });\n\n  const supabase = createServerClient(\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\n    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,\n    {\n      cookies: {\n        getAll() {\n          return request.cookies.getAll();\n        },\n        setAll(cookiesToSet) {\n          cookiesToSet.forEach(({ name, value }) => request.cookies.set(name, value));\n          response = NextResponse.next({ request });\n          cookiesToSet.forEach(({ name, value, options }) => {\n            response.cookies.set(name, value, options);\n          });\n        }\n      }\n    }\n  );\n\n  // IMPORTANT: Avoid writing logic between createServerClient(...) and getClaims().\n  // IMPORTANT: Don't remove getClaims(); it both validates and keeps sessions/cookies in sync.\n  await supabase.auth.getClaims();\n\n  return response;\n}\n```\n\n## 7. Authorization Guidance (Server-side)\n\n- **Never** rely on `supabase.auth.getSession()` for server protection (it reads from storage/cookies and is not a strong guarantee).\n- Use `supabase.auth.getClaims()` to protect pages/user data when JWT validation is sufficient (verifies against JWKS/public keys; commonly used in middleware/proxy).\n- Use `supabase.auth.getUser()` when you need the strongest server-side check (revalidated with Supabase Auth).\n\n## 8. RLS + Schema Coordination (Security Invariant)\n\n- RLS is the enforcement layer; without policies it is effectively default-deny.\n- Policies commonly use `auth.uid()`; schema must include the columns used by policies (`user_id`, `tenant_id`, etc.).\n- Ship table changes and RLS policy updates together (same PR/migration unit).\n\n## 9. Checklist\n\n- [ ] `@supabase/auth-helpers-nextjs` removed and not used.\n- [ ] Browser code uses `createBrowserClient`.\n- [ ] Server code uses per-request `createServerClient` with `getAll/setAll` cookie plumbing.\n- [ ] `setAll` errors are caught in Server Components.\n- [ ] `proxy.ts` refreshes sessions and updates both request and response cookies.\n- [ ] Server protection uses `getClaims()` or `getUser()` (not `getSession()`).\n- [ ] RLS policies and schema evolve together.\n",
  "skills/skill-tailwindcss-v4.md": "---\nskill_name: skill-tailwindcss-v4\nversion: \"4.x\"\nframework: Tailwind CSS\nlast_verified: \"2025-12-26\"\nalways_attach: false\npriority: 6\ntriggers:\n  - tailwind v4\n  - tailwindcss v4\n  - tailwindcss\n  - \"@theme\"\n  - \"@source\"\n  - \"@config\"\n  - \"@tailwindcss/postcss\"\n  - postcss.config\n  - globals.css\n  - tw-animate-css\n  - tailwind.config.js\n---\n\n<!--\nLLM INSTRUCTION: Use for Tailwind CSS v4 (CSS-first). Prevent generating tailwind.config.js by default.\nv4 entry is @import \"tailwindcss\"; (do not emit @tailwind base/components/utilities).\nTheme tokens live in @theme as CSS custom properties; use :root only for non-Tailwind vars.\nPostCSS plugin is @tailwindcss/postcss.\nFor extra scan sources, prefer @source in CSS over a JS config.\nOnly create a JS config when explicitly required; load it via @config (not auto-detected).\ntw-animate-css is CSS-first; import it in CSS.\n-->\n\n# Tailwind CSS v4 (CSS-first)\n\n> **Target:** Tailwind CSS v4 | **Last Verified:** 2025-12-26\n\n## 1. What AI Models Get Wrong\n\n- **Generating `tailwind.config.js` by default** (v4 is CSS-first; avoid JS config unless required).\n- **Using v3 directives** (`@tailwind base/components/utilities`) instead of `@import \"tailwindcss\";`.\n- **Putting design tokens in JS** instead of `@theme` variables.\n- **Adding a `content: []` scan array** (prefer auto-detection; use `@source` when needed).\n- **Using `theme()`** (prefer generated CSS variables).\n\n## 2. Golden Rules\n\n### ✅ DO\n- Use `@import \"tailwindcss\";` as the Tailwind entry in `globals.css`.\n- Define Tailwind tokens in `@theme { --color-...; --font-...; --breakpoint-...; }`.\n- Configure PostCSS with the `@tailwindcss/postcss` plugin.\n- Use `@source` in CSS for monorepo/external scan sources.\n- Import `tw-animate-css` in CSS when needed.\n\n### ❌ DON'T\n- Don’t create `tailwind.config.js` unless explicitly required.\n- Don’t emit `@tailwind base/components/utilities` (v3 pattern).\n- Don’t use `theme()` for new code (prefer `var(--...)`).\n\n## 3. Minimal Setup (Next.js-friendly)\n\n### Install\n```bash\nnpm i tailwindcss @tailwindcss/postcss postcss\n```\n\n### `postcss.config.mjs`\n```js\nexport default {\n  plugins: {\n    \"@tailwindcss/postcss\": {},\n  },\n};\n```\n\n### `app/globals.css` (or `src/app/globals.css`)\n```css\n@import \"tailwindcss\";\n```\n\n## 4. Tokens: `@theme` vs `:root`\n\n### Tailwind tokens (generate utilities)\n```css\n@import \"tailwindcss\";\n\n@theme {\n  --color-brand-500: oklch(0.62 0.2 250);\n  --font-sans: ui-sans-serif, system-ui, sans-serif;\n  --breakpoint-3xl: 120rem;\n  --radius-lg: 0.75rem;\n}\n```\n\n### Non-Tailwind variables (do not generate utilities)\n```css\n:root {\n  --marketing-site-max-width: 72rem;\n}\n```\n\n## 5. Content Scanning\n\n- Default: rely on v4 auto-detection.\n- If you must include extra sources (monorepos/external packages), add `@source`:\n\n```css\n@import \"tailwindcss\";\n@source \"../packages/ui\";\n@source \"../node_modules/@my-company/ui-lib\";\n```\n\n## 6. Legacy Escape Hatch (only when required): `@config`\n\nIf a legacy Tailwind config is unavoidable, load it explicitly:\n\n```css\n@import \"tailwindcss\";\n@config \"../../tailwind.config.js\";\n```\n\n## 7. `tw-animate-css` (Tailwind v4)\n\n### Install\n```bash\nnpm i -D tw-animate-css\n```\n\n### Import in CSS\n```css\n@import \"tailwindcss\";\n@import \"tw-animate-css\";\n```\n\n### Pattern: data-state driven animations\n```tsx\nexport function Toast({ show }: { show: boolean }) {\n  return (\n    <div\n      data-state={show ? \"show\" : \"hide\"}\n      className=\"\n        data-[state=show]:animate-in\n        data-[state=hide]:animate-out\n        fade-in fade-out\n        slide-in-from-top-8 slide-out-to-top-8\n        duration-500\n      \"\n    />\n  );\n}\n```\n\n## 8. Checklist\n\n- [ ] No `tailwind.config.js` added unless explicitly required.\n- [ ] `globals.css` uses `@import \"tailwindcss\";`.\n- [ ] Tokens live in `@theme` (Tailwind) or `:root` (non-Tailwind).\n- [ ] `postcss.config.*` uses `@tailwindcss/postcss`.\n- [ ] Extra scan sources use `@source` (not `content: []`).\n- [ ] `tw-animate-css` imported in CSS when used.\n",
  "skills/skill-typescript-config.md": "---\nskill_name: skill-typescript-config\nversion: \"16.0.10\"\nframework: Next.js\nreact_version: \"19\"\nlast_verified: \"2025-12-18\"\nalways_attach: false\npriority: 6\ntriggers:\n  - next.config\n  - typescript\n  - type error\n  - Promise type\n  - tsconfig\n  - server-only\n  - experimental\n  - cacheComponents\n  - \"@types/react\"\n---\n\n<!--\nLLM INSTRUCTION: Apply when user has type errors or config issues.\nUse next.config.ts (TypeScript) not next.config.js.\nRemove experimental.serverActions - it's stable in v16.\nUse cacheComponents: true instead of experimental.ppr.\nAll params must be typed as Promise<...> - your v14 training types are WRONG.\n@types/react must be v19 for async components to work.\nUse 'server-only' package to prevent accidental client imports.\nmoduleResolution should be \"bundler\" not \"node\".\n-->\n\n# TypeScript & Config\n\n> **Target:** Next.js 16.0.10 | **React:** 19 | **Last Verified:** 2025-12-18\n\n## 1. What AI Models Get Wrong\n\n- **Using `next.config.js`** → LLMs use JavaScript config. v16 officially supports `next.config.ts` with type safety.\n- **Using `experimental.serverActions`** → LLMs enable this flag. Server Actions are stable in v16, no flag needed.\n- **Using `experimental.ppr`** → LLMs suggest this flag. In v16, use `cacheComponents: true` instead.\n- **Wrong Promise types for props** → LLMs type params as objects. In v16, they must be `Promise<...>`.\n- **Importing server-only in 'use client'** → LLMs import database modules in client files. This causes build failure.\n\n## 2. Golden Rules\n\n### ✅ DO\n- **Use `next.config.ts`** → Typed configuration with autocomplete\n- **Type params as Promises** → `params: Promise<{ slug: string }>`\n- **Upgrade @types/react to v19** → Fixes async component type errors\n- **Use `server-only` package** → Prevents accidental client imports\n- **Set `cacheComponents: true`** → Enables 'use cache' and PPR\n\n### ❌ DON'T  \n- **Don't use `experimental.serverActions`** → Stable in v16, no flag needed\n- **Don't use `experimental.ppr`** → Use `cacheComponents` instead\n- **Don't import server code in 'use client' files** → Build failure\n- **Don't use old @types/react** → Causes async component errors\n- **Don't use `publicRuntimeConfig`** → Removed, use env variables\n\n## 3. Critical Patterns\n\n### Typed next.config.ts\n\n**❌ WRONG (v14/v15 - Hallucination Risk):**\n```javascript\n// next.config.js - No type safety\n/** @type {import('next').NextConfig} */\nconst nextConfig = {\n  experimental: {\n    serverActions: true, // Not needed in v16!\n    ppr: true, // Wrong flag\n  },\n};\n\nmodule.exports = nextConfig;\n```\n\n**✅ CORRECT (v16):**\n```typescript\n// next.config.ts - Typed configuration\nimport type { NextConfig } from 'next';\n\nconst nextConfig: NextConfig = {\n  reactStrictMode: true,\n  \n  // v16 Caching - replaces experimental.ppr\n  cacheComponents: true,\n  \n  // Logging for debugging\n  logging: {\n    fetches: {\n      fullUrl: true,\n    },\n  },\n  \n  // Optional: typed routes\n  experimental: {\n    typedRoutes: true,\n  },\n  \n  // Custom cache profiles\n  cacheLife: {\n    'blog-posts': {\n      stale: 3600,\n      revalidate: 900,\n      expire: 86400,\n    },\n  },\n};\n\nexport default nextConfig;\n```\n**Why:** TypeScript config provides autocomplete and catches invalid options at compile time.\n\n---\n\n### Promise Props Type Errors\n\n**❌ WRONG (v14/v15 - Hallucination Risk):**\n```typescript\n// Error: Property 'slug' does not exist on type 'Promise<...>'\ninterface Props {\n  params: { slug: string }; // Wrong type\n}\n\nexport default function Page({ params }: Props) {\n  return <h1>{params.slug}</h1>; // Type error AND runtime error\n}\n```\n\n**✅ CORRECT (v16):**\n```typescript\n// Correct Promise types\ninterface Props {\n  params: Promise<{ slug: string }>;\n  searchParams: Promise<{ [key: string]: string | string[] | undefined }>;\n}\n\nexport default async function Page({ params, searchParams }: Props) {\n  const { slug } = await params;\n  const query = await searchParams;\n  \n  return <h1>{slug}</h1>;\n}\n\n// For layouts\ninterface LayoutProps {\n  children: React.ReactNode;\n  params: Promise<{ slug: string }>;\n}\n\nexport default async function Layout({ children, params }: LayoutProps) {\n  const { slug } = await params;\n  return <div data-slug={slug}>{children}</div>;\n}\n```\n**Why:** v16 types params as Promises to support PPR streaming architecture.\n\n---\n\n### Async Component Type Errors\n\n**❌ WRONG (v14/React 18 types - Hallucination Risk):**\n```typescript\n// Error: 'Page' cannot be used as a JSX component\n// This happens with old @types/react\nexport default async function Page() {\n  const data = await fetch('https://api.example.com/data').then(r => r.json());\n  return <div>{data.title}</div>;\n}\n```\n\n**✅ CORRECT (v16/React 19 types):**\n```json\n// package.json - Ensure React 19 types\n{\n  \"dependencies\": {\n    \"react\": \"^19.0.0\",\n    \"react-dom\": \"^19.0.0\",\n    \"next\": \"^16.0.10\"\n  },\n  \"devDependencies\": {\n    \"@types/react\": \"^19.0.0\",\n    \"@types/react-dom\": \"^19.0.0\",\n    \"typescript\": \"^5.0.0\"\n  }\n}\n```\n\n```typescript\n// Now async components work without errors\nexport default async function Page() {\n  const data = await fetch('https://api.example.com/data').then(r => r.json());\n  return <div>{data.title}</div>;\n}\n```\n**Why:** React 19 types support async components natively; old v18 types don't.\n\n---\n\n### Server-Only Module Protection\n\n**❌ WRONG (v14/v15 - Hallucination Risk):**\n```typescript\n// lib/db.ts - Can accidentally be imported in client\nimport { prisma } from './prisma';\n\nexport async function getUsers() {\n  return prisma.user.findMany();\n}\n\n// components/UserList.tsx\n'use client';\nimport { getUsers } from '../lib/db'; // BUILD FAILURE\n```\n\n**✅ CORRECT (v16):**\n```typescript\n// lib/db.ts - Protected with server-only\nimport 'server-only'; // Import at top of file\nimport { prisma } from './prisma';\n\nexport async function getUsers() {\n  return prisma.user.findMany();\n}\n\n// components/UserList.tsx\n'use client';\n// Cannot import from db.ts - build error with clear message:\n// \"You're importing a component that needs server-only\"\n\n// Instead, pass data as props from Server Component\nexport function UserList({ users }: { users: User[] }) {\n  return <ul>{users.map(u => <li key={u.id}>{u.name}</li>)}</ul>;\n}\n```\n**Why:** `server-only` package prevents accidental imports in client bundles.\n\n---\n\n### Module Resolution Issues\n\n**❌ WRONG (v14/v15 - Hallucination Risk):**\n```typescript\n// tsconfig.json with loose settings\n{\n  \"compilerOptions\": {\n    \"moduleResolution\": \"node\", // May cause issues\n    \"paths\": {\n      \"@/*\": [\"./src/*\"] // Path doesn't match actual structure\n    }\n  }\n}\n```\n\n**✅ CORRECT (v16):**\n```json\n// tsconfig.json - Correct settings for Next 16\n{\n  \"compilerOptions\": {\n    \"target\": \"ES2017\",\n    \"lib\": [\"dom\", \"dom.iterable\", \"esnext\"],\n    \"allowJs\": true,\n    \"skipLibCheck\": true,\n    \"strict\": true,\n    \"noEmit\": true,\n    \"esModuleInterop\": true,\n    \"module\": \"esnext\",\n    \"moduleResolution\": \"bundler\",\n    \"resolveJsonModule\": true,\n    \"isolatedModules\": true,\n    \"jsx\": \"preserve\",\n    \"incremental\": true,\n    \"plugins\": [\n      { \"name\": \"next\" }\n    ],\n    \"paths\": {\n      \"@/*\": [\"./*\"]\n    }\n  },\n  \"include\": [\"next-env.d.ts\", \"**/*.ts\", \"**/*.tsx\", \".next/types/**/*.ts\"],\n  \"exclude\": [\"node_modules\"]\n}\n```\n**Why:** `moduleResolution: \"bundler\"` is recommended for Next 16 with modern bundlers.\n\n## 4. Quick Reference Table\n\n| Feature | ❌ Don't | ✅ Do |\n|---------|---------|------|\n| Config File | `next.config.js` | `next.config.ts` |\n| Server Actions | `experimental.serverActions` | Remove (stable) |\n| PPR | `experimental.ppr` | `cacheComponents: true` |\n| Params Type | `{ slug: string }` | `Promise<{ slug: string }>` |\n| React Types | `@types/react@18` | `@types/react@19` |\n| Server Code | Unprotected | `import 'server-only'` |\n| Runtime Config | `publicRuntimeConfig` | Environment variables |\n| Module Resolution | `\"node\"` | `\"bundler\"` |\n\n## 5. Checklist Before Coding\n\n- [ ] Using `next.config.ts` (not .js) with `NextConfig` type\n- [ ] Removed `experimental.serverActions` (stable in v16)\n- [ ] Using `cacheComponents: true` instead of `experimental.ppr`\n- [ ] All params/searchParams typed as `Promise<...>`\n- [ ] `@types/react` and `@types/react-dom` are v19\n- [ ] Server-only modules import `'server-only'` at top\n- [ ] `tsconfig.json` uses `moduleResolution: \"bundler\"`\n",
  "skills/skill-vitest-playwright-testing.md": "---\nskill_name: skill-vitest-playwright-testing\nversion: \"1.0\"\nframework: Next.js\nlast_verified: \"2025-12-26\"\nalways_attach: false\npriority: 6\ntriggers:\n  - vitest\n  - playwright\n  - @vitejs/plugin-react\n  - jsdom\n  - vitest.config\n  - playwright.config\n  - \"*.test.ts\"\n  - \"*.test.tsx\"\n  - tests/*.spec.ts\n  - coverage\n  - next/headers\n  - cookies()\n  - headers()\n  - supabase\n  - vi.mock\n---\n\n<!--\nLLM INSTRUCTION: Use for repositories that run Vitest for unit/component tests and Playwright for E2E.\nKeep unit tests as *.test.ts(x) and Playwright tests under tests/*.spec.ts.\nVitest must exclude tests/**; Playwright must use testDir: 'tests'.\nMock next/headers (cookies/headers) in Vitest when code depends on request scope.\nPrefer mocking your own Supabase wrapper module rather than mocking @supabase/supabase-js directly.\nCoverage config should include provider, reporters, include/exclude, and thresholds; run coverage via CLI flag.\n-->\n\n# Testing Stack: Vitest + Playwright (Next.js / React)\n\n> **Target:** Next.js + React | **Last Verified:** 2025-12-26\n\n## 1. What AI Models Get Wrong\n\n- Mixing unit + E2E file patterns so runners pick up the wrong tests.\n- Forgetting `@vitejs/plugin-react` or `jsdom` in Vitest for React DOM tests.\n- Not providing a shared `vitest.setup.ts` (matchers + global mocks).\n- Trying to unit-test async Server Component flows instead of using Playwright.\n- Breaking request-scoped code by not mocking `next/headers` (`cookies()` / `headers()`).\n\n## 2. Golden Rules\n\n### ✅ DO\n- **Vitest:** `*.test.ts` / `*.test.tsx` for unit/component tests.\n- **Playwright:** `tests/*.spec.ts` for E2E tests.\n- Ensure **Vitest excludes `tests/**`** and **Playwright uses `testDir: 'tests'`**.\n- Use `vitest.setup.ts` for `@testing-library/jest-dom/vitest` and shared mocks.\n- Mock `next/headers` in unit tests when server code touches cookies/headers.\n- Run E2E against `build` + `start` for realism.\n\n### ❌ DON'T\n- Don’t let Vitest execute Playwright specs (keep patterns separated).\n- Don’t rely on real request context in unit tests.\n- Don’t unit-test full server flows that depend on Next.js runtime; prefer Playwright.\n\n## 3. Vitest Baseline\n\n### `vitest.config.ts`\n```ts\nimport { defineConfig } from 'vitest/config';\nimport react from '@vitejs/plugin-react';\nimport tsconfigPaths from 'vite-tsconfig-paths';\n\nexport default defineConfig({\n  plugins: [tsconfigPaths(), react()],\n  test: {\n    environment: 'jsdom',\n    include: ['**/*.test.ts', '**/*.test.tsx'],\n    exclude: ['tests/**', 'node_modules/**', '.next/**', 'dist/**'],\n    setupFiles: ['./vitest.setup.ts'],\n    clearMocks: true,\n    restoreMocks: true,\n    mockReset: true,\n    coverage: {\n      provider: 'v8',\n      reporter: ['text', 'html', 'lcov'],\n      reportsDirectory: './coverage',\n      include: ['src/**/*.{ts,tsx}', 'app/**/*.{ts,tsx}'],\n      exclude: [\n        '**/*.test.{ts,tsx}',\n        'tests/**',\n        '.next/**',\n        'dist/**',\n        '**/*.d.ts'\n      ],\n      thresholds: { lines: 80, functions: 80, statements: 80, branches: 70 }\n    }\n  }\n});\n```\n\n### `vitest.setup.ts`\n```ts\nimport '@testing-library/jest-dom/vitest';\nimport { vi } from 'vitest';\n\nconst cookieStore = {\n  get: vi.fn((name: string) => ({ name, value: 'cookie' })),\n  getAll: vi.fn(() => []),\n  set: vi.fn(),\n  delete: vi.fn()\n};\n\nvi.mock('next/headers', () => ({\n  cookies: vi.fn(async () => cookieStore),\n  headers: vi.fn(async () => new Headers({ 'user-agent': 'vitest' }))\n}));\n```\n\n## 4. Supabase Mocking Pattern\n\nPrefer a wrapper module (example): `src/lib/supabase/client.ts` exporting a single `supabase` client.\nMock that wrapper in unit tests instead of mocking `@supabase/supabase-js` internals.\n\n## 5. Playwright Baseline\n\n### `playwright.config.ts`\n```ts\nimport { defineConfig, devices } from '@playwright/test';\n\nexport default defineConfig({\n  testDir: 'tests',\n  testMatch: /.*\\\\.spec\\\\.ts/,\n  fullyParallel: true,\n  forbidOnly: !!process.env.CI,\n  retries: process.env.CI ? 2 : 0,\n  workers: process.env.CI ? 1 : undefined,\n  reporter: 'html',\n  use: {\n    baseURL: process.env.PLAYWRIGHT_BASE_URL ?? 'http://localhost:3000',\n    trace: 'on-first-retry'\n  },\n  webServer: {\n    command: 'npm run start',\n    url: 'http://localhost:3000',\n    reuseExistingServer: !process.env.CI\n  },\n  projects: [{ name: 'chromium', use: { ...devices['Desktop Chrome'] } }]\n});\n```\n\n## 6. Required Scripts\n\n```json\n{\n  \"scripts\": {\n    \"test\": \"vitest\",\n    \"test:unit\": \"vitest run\",\n    \"test:coverage\": \"vitest run --coverage.enabled\",\n    \"test:e2e\": \"npm run build && npx playwright test\"\n  }\n}\n```\n\n## 7. Checklist\n\n- [ ] Unit tests use `*.test.ts(x)` and exclude `tests/**`.\n- [ ] E2E tests live in `tests/*.spec.ts` and Playwright uses `testDir: 'tests'`.\n- [ ] `vitest.setup.ts` exists and includes jest-dom matchers.\n- [ ] `next/headers` is mocked in unit tests where needed.\n- [ ] Coverage has provider + reporters + include/exclude + thresholds.\n- [ ] E2E runs against production build (`build` + `start`).\n"
} as const;
